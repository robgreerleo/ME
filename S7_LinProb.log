-------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\roble\Desktop\Working\STATA\HW 7/leonard_exc7.log
  log type:  text
 opened on:  10 Dec 2017, 17:25:54

. 
. ********************************************************
. * Q.1 Set up dataset
. use "$datadir/LCD_ind", clear

. * set up Globo coverage
. gen globo = (yr1stcov<year)

. lab var globo "Globo coverage in previous year"

. 
. // indicator specifying areas below 95 percentile
. sum geoarea80, detail

                  size of AMC in km2, 1980
-------------------------------------------------------------
      Percentiles      Smallest
 1%           29              8
 5%          113              8
10%          172              8       Obs           2,402,681
25%          336              8       Sum of Wgt.   2,402,681

50%          781                      Mean           11110.32
                        Largest       Std. Dev.      50282.58
75%         1810         367284
90%         8062         367284       Variance       2.53e+09
95%        20618         367284       Skewness       5.934234
99%       347235         367284       Kurtosis       38.31977

. * Problem: some districts have more observations due to a longer time span
. * of measurment.  Want to take each AMC area only once.
. bysort amc_code: gen _nobs = _n

. sum geoarea80, detail

                  size of AMC in km2, 1980
-------------------------------------------------------------
      Percentiles      Smallest
 1%           29              8
 5%          113              8
10%          172              8       Obs           2,402,681
25%          336              8       Sum of Wgt.   2,402,681

50%          781                      Mean           11110.32
                        Largest       Std. Dev.      50282.58
75%         1810         367284
90%         8062         367284       Variance       2.53e+09
95%        20618         367284       Skewness       5.934234
99%       347235         367284       Kurtosis       38.31977

. sum geoarea80 if _nobs==1, detail

                  size of AMC in km2, 1980
-------------------------------------------------------------
      Percentiles      Smallest
 1%           42              8
 5%           91              8
10%          127             14       Obs               3,659
25%          222             19       Sum of Wgt.       3,659

50%          446                      Mean           2309.731
                        Largest       Std. Dev.      14153.58
75%         1062         243044
90%         2905         346812       Variance       2.00e+08
95%         5994         347235       Skewness       17.70853
99%        34035         367284       Kurtosis       381.2895

. 
. gen large = (geoarea80>=r(p95))

. tab large

      large |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  2,102,431       87.50       87.50
          1 |    300,250       12.50      100.00
------------+-----------------------------------
      Total |  2,402,681      100.00

. * actually ends up being 12.5% of the total data sample
. * can keep data and add constraints, or drop the data (here we don't need it)
. drop if large==1
(300,250 observations deleted)

. 
. ********************************************************
. * Q.2 Replicate Table 2
. 
. // column 1
. // we could set up the time dummies by hand
. tab year, gen(y_)

       Year |      Freq.     Percent        Cum.
------------+-----------------------------------
       1979 |    135,352        6.44        6.44
       1980 |    139,706        6.64       13.08
       1981 |    143,997        6.85       19.93
       1982 |    148,290        7.05       26.99
       1983 |    152,728        7.26       34.25
       1984 |    157,381        7.49       41.74
       1985 |    161,733        7.69       49.43
       1986 |    165,671        7.88       57.31
       1987 |    170,016        8.09       65.39
       1988 |    174,723        8.31       73.71
       1989 |    179,342        8.53       82.24
       1990 |    184,211        8.76       91.00
       1991 |    189,281        9.00      100.00
------------+-----------------------------------
      Total |  2,102,431      100.00

. reg birth globo y_* 
note: y_1 omitted because of collinearity

      Source |       SS           df       MS      Number of obs   = 2,102,431
-------------+----------------------------------   F(13, 2102417)  =    504.12
       Model |  582.868233        13  44.8360179   Prob > F        =    0.0000
    Residual |  186989.031 2,102,417   .08894003   R-squared       =    0.0031
-------------+----------------------------------   Adj R-squared   =    0.0031
       Total |  187571.899 2,102,430  .089216716   Root MSE        =    .29823

------------------------------------------------------------------------------
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0294689   .0005045   -58.41   0.000    -.0304577   -.0284801
         y_1 |          0  (omitted)
         y_2 |   .0042427   .0011379     3.73   0.000     .0020124     .006473
         y_3 |   .0074939   .0011367     6.59   0.000      .005266    .0097219
         y_4 |   .0090262   .0011361     7.94   0.000     .0067995    .0112529
         y_5 |   .0040452   .0011308     3.58   0.000     .0018288    .0062616
         y_6 |  -.0006472   .0011242    -0.58   0.565    -.0028507    .0015563
         y_7 |  -.0029818   .0011185    -2.67   0.008    -.0051741   -.0007896
         y_8 |  -.0042063   .0011154    -3.77   0.000    -.0063924   -.0020201
         y_9 |  -.0048817    .001114    -4.38   0.000    -.0070651   -.0026983
        y_10 |  -.0064706   .0011137    -5.81   0.000    -.0086534   -.0042879
        y_11 |  -.0089174   .0011113    -8.02   0.000    -.0110955   -.0067393
        y_12 |  -.0146742   .0011079   -13.24   0.000    -.0168457   -.0125027
        y_13 |  -.0143408    .001103   -13.00   0.000    -.0165026    -.012179
       _cons |   .1237332   .0008265   149.70   0.000     .1221132    .1253532
------------------------------------------------------------------------------

. * note one is dropped, could rerun to change output order
. reg birth globo y_1-y_12

      Source |       SS           df       MS      Number of obs   = 2,102,431
-------------+----------------------------------   F(13, 2102417)  =    504.12
       Model |  582.868233        13  44.8360179   Prob > F        =    0.0000
    Residual |  186989.031 2,102,417   .08894003   R-squared       =    0.0031
-------------+----------------------------------   Adj R-squared   =    0.0031
       Total |  187571.899 2,102,430  .089216716   Root MSE        =    .29823

------------------------------------------------------------------------------
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0294689   .0005045   -58.41   0.000    -.0304577   -.0284801
         y_1 |   .0143408    .001103    13.00   0.000      .012179    .0165026
         y_2 |   .0185835   .0010849    17.13   0.000     .0164571    .0207098
         y_3 |   .0218347   .0010562    20.67   0.000     .0197646    .0239048
         y_4 |    .023367   .0010407    22.45   0.000     .0213273    .0254066
         y_5 |    .018386   .0010307    17.84   0.000     .0163658    .0204062
         y_6 |   .0136936   .0010218    13.40   0.000     .0116909    .0156963
         y_7 |   .0113589   .0010138    11.20   0.000     .0093719    .0133459
         y_8 |   .0101345   .0010062    10.07   0.000     .0081625    .0121066
         y_9 |    .009459   .0009979     9.48   0.000     .0075032    .0114149
        y_10 |   .0078701   .0009898     7.95   0.000     .0059302    .0098101
        y_11 |   .0054234   .0009828     5.52   0.000     .0034971    .0073497
        y_12 |  -.0003334   .0009761    -0.34   0.733    -.0022465    .0015796
       _cons |   .1093924   .0008259   132.45   0.000     .1077736    .1110112
------------------------------------------------------------------------------

. * Cluster the standard errors - observations aren't drawn randomly
. * they are related and their error terms are not independent
. reg birth globo y_1-y_12, cluster(amc_code)

Linear regression                               Number of obs     =  2,102,431
                                                F(13, 3475)       =     150.18
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0031
                                                Root MSE          =     .29823

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0294689   .0037997    -7.76   0.000    -.0369187   -.0220191
         y_1 |   .0143408   .0030832     4.65   0.000     .0082956    .0203859
         y_2 |   .0185835   .0026637     6.98   0.000     .0133609     .023806
         y_3 |   .0218347   .0022813     9.57   0.000     .0173619    .0263075
         y_4 |    .023367   .0017918    13.04   0.000     .0198538    .0268801
         y_5 |    .018386   .0019122     9.62   0.000     .0146368    .0221352
         y_6 |   .0136936   .0016164     8.47   0.000     .0105243    .0168629
         y_7 |   .0113589   .0015047     7.55   0.000     .0084087    .0143092
         y_8 |   .0101345    .001474     6.88   0.000     .0072446    .0130245
         y_9 |    .009459   .0013891     6.81   0.000     .0067354    .0121827
        y_10 |   .0078701   .0010076     7.81   0.000     .0058946    .0098456
        y_11 |   .0054234   .0009525     5.69   0.000     .0035559    .0072909
        y_12 |  -.0003334   .0008788    -0.38   0.704    -.0020564    .0013896
       _cons |   .1093924   .0026194    41.76   0.000     .1042568     .114528
------------------------------------------------------------------------------

. //use sample weights
. reg birth globo y_1-y_12 [aweight = weight], cluster(amc_code)
(sum of wgt is 18524556.1277)

Linear regression                               Number of obs     =  2,102,431
                                                F(13, 3475)       =     121.31
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0027
                                                Root MSE          =     .29146

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0269048   .0037364    -7.20   0.000    -.0342306    -.019579
         y_1 |   .0141231    .002882     4.90   0.000     .0084725    .0197737
         y_2 |   .0187496   .0025918     7.23   0.000      .013668    .0238312
         y_3 |   .0217675   .0020951    10.39   0.000     .0176596    .0258753
         y_4 |   .0222606   .0016447    13.54   0.000      .019036    .0254852
         y_5 |    .016815   .0018453     9.11   0.000     .0131971     .020433
         y_6 |   .0129105   .0015686     8.23   0.000     .0098351    .0159859
         y_7 |   .0098351   .0014717     6.68   0.000     .0069497    .0127206
         y_8 |   .0098132   .0013937     7.04   0.000     .0070807    .0125458
         y_9 |   .0083598   .0014899     5.61   0.000     .0054386    .0112809
        y_10 |   .0069116    .001051     6.58   0.000      .004851    .0089722
        y_11 |   .0051481   .0009988     5.15   0.000     .0031898    .0071064
        y_12 |  -.0000964   .0009783    -0.10   0.921    -.0020145    .0018217
       _cons |   .1035889   .0026144    39.62   0.000      .098463    .1087148
------------------------------------------------------------------------------

. 
. // use i.year instead to genereate dummies, i is for integer data
. reg birth globo i.year [aweight = weight], cluster(amc_code)
(sum of wgt is 18524556.1277)

Linear regression                               Number of obs     =  2,102,431
                                                F(13, 3475)       =     121.31
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0027
                                                Root MSE          =     .29146

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0269048   .0037364    -7.20   0.000    -.0342306    -.019579
             |
        year |
       1980  |   .0046264   .0013019     3.55   0.000     .0020739    .0071789
       1981  |   .0076443   .0015858     4.82   0.000     .0045352    .0107534
       1982  |   .0081374   .0019885     4.09   0.000     .0042386    .0120363
       1983  |   .0026919   .0017746     1.52   0.129    -.0007875    .0061713
       1984  |  -.0012127   .0019789    -0.61   0.540    -.0050926    .0026673
       1985  |   -.004288   .0022088    -1.94   0.052    -.0086187    .0000427
       1986  |  -.0043099   .0022338    -1.93   0.054    -.0086895    .0000697
       1987  |  -.0057634   .0022576    -2.55   0.011    -.0101898   -.0013369
       1988  |  -.0072115   .0026582    -2.71   0.007    -.0124233   -.0019997
       1989  |   -.008975   .0025559    -3.51   0.000    -.0139863   -.0039638
       1990  |  -.0142196   .0027838    -5.11   0.000    -.0196776   -.0087615
       1991  |  -.0141231    .002882    -4.90   0.000    -.0197737   -.0084725
             |
       _cons |   .1177121   .0015315    76.86   0.000     .1147093    .1207149
------------------------------------------------------------------------------

. est store e1

. 
. // column 2, now include area fixed effects, absorb(fixed effect)
. areg birth globo i.year [aweight=weight], cluster(amc_code) ///
>  absorb(uf_code)
(sum of wgt is 18524556.1277)

Linear regression, absorbing indicators         Number of obs     =  2,102,431
                                                F(  13,   3475)   =      86.09
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0055
                                                Adj R-squared     =     0.0055
                                                Root MSE          =     0.2911

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0114512   .0025974    -4.41   0.000    -.0165438   -.0063586
             |
        year |
       1980  |   .0034575   .0012735     2.72   0.007     .0009607    .0059544
       1981  |   .0035731    .001324     2.70   0.007     .0009773    .0061689
       1982  |   .0025524   .0017696     1.44   0.149    -.0009172     .006022
       1983  |  -.0033272   .0015257    -2.18   0.029    -.0063185   -.0003359
       1984  |  -.0074531   .0017619    -4.23   0.000    -.0109076   -.0039987
       1985  |  -.0107798   .0020069    -5.37   0.000    -.0147146    -.006845
       1986  |  -.0112631   .0018884    -5.96   0.000    -.0149657   -.0075606
       1987  |  -.0134572   .0020414    -6.59   0.000    -.0174597   -.0094546
       1988  |  -.0158396   .0022845    -6.93   0.000    -.0203188   -.0113605
       1989  |  -.0181156   .0022657    -8.00   0.000     -.022558   -.0136733
       1990  |  -.0237238   .0024783    -9.57   0.000     -.028583   -.0188647
       1991  |  -.0238323   .0025102    -9.49   0.000    -.0287538   -.0189108
             |
       _cons |   .1126478   .0015748    71.53   0.000     .1095602    .1157354
-------------+----------------------------------------------------------------
     uf_code |   absorbed                                      (23 categories)

. est store e2

. 
. // column 3, now fixed effects at AMC level
. areg birth globo i.year [aweight=weight], cluster(amc_code) ///
>  absorb(amc_code)
(sum of wgt is 18524556.1277)

Linear regression, absorbing indicators         Number of obs     =  2,102,431
                                                F(  13,   3475)   =      80.35
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0123
                                                Adj R-squared     =     0.0106
                                                Root MSE          =     0.2903

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0059957   .0014962    -4.01   0.000    -.0089293   -.0030621
             |
        year |
       1980  |   .0030291   .0012622     2.40   0.016     .0005544    .0055037
       1981  |   .0020626   .0012392     1.66   0.096     -.000367    .0044923
       1982  |   .0005062   .0016608     0.30   0.761      -.00275    .0037623
       1983  |  -.0055073   .0013186    -4.18   0.000    -.0080926    -.002922
       1984  |  -.0097553   .0015761    -6.19   0.000    -.0128455    -.006665
       1985  |  -.0131837   .0018128    -7.27   0.000    -.0167379   -.0096294
       1986  |  -.0138182   .0016783    -8.23   0.000    -.0171087   -.0105276
       1987  |  -.0163063   .0017521    -9.31   0.000    -.0197415    -.012871
       1988  |  -.0190487    .002144    -8.88   0.000    -.0232523   -.0148451
       1989  |  -.0215405   .0020451   -10.53   0.000    -.0255501   -.0175308
       1990  |  -.0273252   .0022902   -11.93   0.000    -.0318154    -.022835
       1991  |  -.0275671   .0023245   -11.86   0.000    -.0321246   -.0230095
             |
       _cons |   .1109897   .0010889   101.93   0.000     .1088548    .1131247
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. est store e3

. 
. // generate additional variables for columns 4-6
. gen age2 = age^2

. gen stock2 = stock^2
(295 missing values generated)

. label var age2 "Age sq."

. label var stock2 "Stock sq."

. // set up global macro for all the control variables
. global controls "age age2 stock stock2 yrsedu_head wealth_noTV married catholic rural doctors ipc"

. 
. // column 4
. reg birth globo $controls i.year [aweight = weight], cluster(amc_code)
(sum of wgt is 18522526.5012)

Linear regression                               Number of obs     =  2,102,136
                                                F(24, 3475)       =     840.08
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0459
                                                Root MSE          =     .28506

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0074696   .0011729    -6.37   0.000    -.0097693     -.00517
         age |   .0229524   .0005357    42.85   0.000     .0219022    .0240027
        age2 |  -.0004208   .0000105   -39.93   0.000    -.0004415   -.0004002
       stock |    .002857   .0006798     4.20   0.000     .0015241    .0041899
      stock2 |    -.00006   .0000368    -1.63   0.103    -.0001322    .0000121
 yrsedu_head |  -.0001524   .0001089    -1.40   0.162    -.0003659    .0000611
 wealth_noTV |  -.0208117   .0003207   -64.89   0.000    -.0214405   -.0201828
     married |    .056727   .0010304    55.05   0.000     .0547068    .0587471
    catholic |  -.0025266   .0005669    -4.46   0.000     -.003638   -.0014151
       rural |  -.0042812   .0012378    -3.46   0.001     -.006708   -.0018543
     doctors |   -.074013   .0710446    -1.04   0.298    -.2133064    .0652803
         ipc |   .0111874   .0068781     1.63   0.104    -.0022982     .024673
             |
        year |
       1980  |   .0032306   .0012469     2.59   0.010     .0007859    .0056753
       1981  |   .0025581   .0011941     2.14   0.032     .0002169    .0048993
       1982  |   .0014491   .0014285     1.01   0.310    -.0013518      .00425
       1983  |  -.0039664   .0012119    -3.27   0.001    -.0063425   -.0015904
       1984  |  -.0074225    .001302    -5.70   0.000    -.0099752   -.0048698
       1985  |  -.0099975   .0014923    -6.70   0.000    -.0129234   -.0070715
       1986  |  -.0099437   .0013947    -7.13   0.000    -.0126781   -.0072092
       1987  |  -.0112639   .0014911    -7.55   0.000    -.0141874   -.0083403
       1988  |  -.0126421   .0016327    -7.74   0.000    -.0158433    -.009441
       1989  |  -.0135906   .0015408    -8.82   0.000    -.0166116   -.0105696
       1990  |  -.0178449   .0016601   -10.75   0.000    -.0210998     -.01459
       1991  |  -.0164138   .0016803    -9.77   0.000    -.0197084   -.0131193
             |
       _cons |  -.1930317   .0068586   -28.14   0.000     -.206479   -.1795845
------------------------------------------------------------------------------

. est store e4

. 
. // column 5
. areg birth globo $controls i.year [aweight=weight], cluster(amc_code) ///
>  absorb(uf_code)
(sum of wgt is 18522526.5012)

Linear regression, absorbing indicators         Number of obs     =  2,102,136
                                                F(  24,   3475)   =     494.23
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0464
                                                Adj R-squared     =     0.0464
                                                Root MSE          =     0.2850

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0041716    .001042    -4.00   0.000    -.0062145   -.0021286
         age |   .0229896   .0005354    42.94   0.000     .0219399    .0240393
        age2 |  -.0004208   .0000105   -39.97   0.000    -.0004415   -.0004002
       stock |    .002655   .0006638     4.00   0.000     .0013536    .0039565
      stock2 |  -.0000597   .0000361    -1.65   0.098    -.0001305    .0000111
 yrsedu_head |  -.0001642   .0001091    -1.50   0.132    -.0003782    .0000498
 wealth_noTV |  -.0204046   .0003327   -61.33   0.000    -.0210569   -.0197523
     married |   .0574843   .0011342    50.68   0.000     .0552605     .059708
    catholic |  -.0034131   .0006104    -5.59   0.000    -.0046099   -.0022163
       rural |  -.0054415   .0010715    -5.08   0.000    -.0075422   -.0033407
     doctors |  -.0733167   .0713169    -1.03   0.304    -.2131439    .0665105
         ipc |   .0015958   .0086623     0.18   0.854    -.0153878    .0185794
             |
        year |
       1980  |   .0029472   .0012501     2.36   0.018     .0004961    .0053982
       1981  |     .00165   .0012024     1.37   0.170    -.0007075    .0040075
       1982  |   .0002217   .0014768     0.15   0.881    -.0026738    .0031172
       1983  |  -.0052825   .0011878    -4.45   0.000    -.0076112   -.0029537
       1984  |  -.0087829   .0013247    -6.63   0.000    -.0113801   -.0061856
       1985  |  -.0114143   .0015397    -7.41   0.000     -.014433   -.0083955
       1986  |  -.0114596   .0014136    -8.11   0.000    -.0142312   -.0086881
       1987  |  -.0129344   .0014626    -8.84   0.000     -.015802   -.0100667
       1988  |  -.0145149    .001704    -8.52   0.000    -.0178559   -.0111739
       1989  |  -.0155729   .0015859    -9.82   0.000    -.0186823   -.0124635
       1990  |  -.0199166   .0017102   -11.65   0.000    -.0232697   -.0165635
       1991  |  -.0185207   .0017264   -10.73   0.000    -.0219056   -.0151358
             |
       _cons |  -.1940484    .006906   -28.10   0.000    -.2075887   -.1805082
-------------+----------------------------------------------------------------
     uf_code |   absorbed                                      (23 categories)

. est store e5

. 
. // column 6
. areg birth globo $controls i.year [aweight=weight], cluster(amc_code) ///
>  absorb(amc_code)
(sum of wgt is 18522526.5012)

Linear regression, absorbing indicators         Number of obs     =  2,102,136
                                                F(  24,   3475)   =     587.14
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0495
                                                Adj R-squared     =     0.0479
                                                Root MSE          =     0.2848

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0047428   .0012119    -3.91   0.000    -.0071189   -.0023668
         age |   .0231351   .0005533    41.81   0.000     .0220503      .02422
        age2 |  -.0004213   .0000107   -39.50   0.000    -.0004422   -.0004003
       stock |    .001745   .0006062     2.88   0.004     .0005564    .0029335
      stock2 |  -.0000222   .0000341    -0.65   0.515     -.000089    .0000446
 yrsedu_head |  -.0001749   .0001182    -1.48   0.139    -.0004066    .0000568
 wealth_noTV |  -.0204725   .0003396   -60.28   0.000    -.0211384   -.0198066
     married |   .0580721   .0011907    48.77   0.000     .0557375    .0604066
    catholic |  -.0033082   .0006075    -5.45   0.000    -.0044992   -.0021171
       rural |  -.0047858   .0011489    -4.17   0.000    -.0070384   -.0025331
     doctors |   -.051476   .0748226    -0.69   0.492    -.1981768    .0952248
         ipc |   -.364554   .0628087    -5.80   0.000    -.4876996   -.2414084
             |
        year |
       1980  |   .0019242   .0013407     1.44   0.151    -.0007044    .0045529
       1981  |   .0006872   .0013149     0.52   0.601    -.0018908    .0032653
       1982  |  -.0007068   .0012748    -0.55   0.579    -.0032063    .0017926
       1983  |  -.0062064   .0012687    -4.89   0.000    -.0086938    -.003719
       1984  |  -.0097499   .0012554    -7.77   0.000    -.0122114   -.0072885
       1985  |  -.0124076   .0013417    -9.25   0.000    -.0150382   -.0097769
       1986  |  -.0124547   .0013355    -9.33   0.000    -.0150731   -.0098362
       1987  |  -.0139403   .0014555    -9.58   0.000     -.016794   -.0110866
       1988  |  -.0155197   .0014217   -10.92   0.000    -.0183072   -.0127321
       1989  |  -.0165879    .001451   -11.43   0.000    -.0194328   -.0137429
       1990  |   -.021474   .0014938   -14.38   0.000    -.0244028   -.0185453
       1991  |  -.0201054   .0015581   -12.90   0.000    -.0231603   -.0170504
             |
       _cons |  -.1876768   .0074384   -25.23   0.000    -.2022608   -.1730927
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. est store e6

. * take coefficients from c6 and the info from the fixed effect
. predict pr_birth_6, xbd
(295 missing values generated)

. predict pr_birth_6_test
(option xb assumed; fitted values)
(295 missing values generated)

. sum pr_*

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  pr_birth_6 |  2,102,136    .0971627    .0661582  -.1904427   .4180207
pr_birth_6~t |  2,102,136    .0984238     .067411  -.1925161   .2660535

. // when predicting values we have to make sure that we take into account the 
. // values for the absorbed variables as well; otherwise it would be similar to 
. // not using year dummies to make the predictions.
. 
. esttab e1 e2 e3 e4 e5 e6, drop(*.year) 

------------------------------------------------------------------------------------------------------------
                      (1)             (2)             (3)             (4)             (5)             (6)   
                    birth           birth           birth           birth           birth           birth   
------------------------------------------------------------------------------------------------------------
globo             -0.0269***      -0.0115***     -0.00600***     -0.00747***     -0.00417***     -0.00474***
                  (-7.20)         (-4.41)         (-4.01)         (-6.37)         (-4.00)         (-3.91)   

age                                                                0.0230***       0.0230***       0.0231***
                                                                  (42.85)         (42.94)         (41.81)   

age2                                                            -0.000421***    -0.000421***    -0.000421***
                                                                 (-39.93)        (-39.97)        (-39.50)   

stock                                                             0.00286***      0.00266***      0.00174** 
                                                                   (4.20)          (4.00)          (2.88)   

stock2                                                         -0.0000600      -0.0000597      -0.0000222   
                                                                  (-1.63)         (-1.65)         (-0.65)   

yrsedu_head                                                     -0.000152       -0.000164       -0.000175   
                                                                  (-1.40)         (-1.50)         (-1.48)   

wealth_noTV                                                       -0.0208***      -0.0204***      -0.0205***
                                                                 (-64.89)        (-61.33)        (-60.28)   

married                                                            0.0567***       0.0575***       0.0581***
                                                                  (55.05)         (50.68)         (48.77)   

catholic                                                         -0.00253***     -0.00341***     -0.00331***
                                                                  (-4.46)         (-5.59)         (-5.45)   

rural                                                            -0.00428***     -0.00544***     -0.00479***
                                                                  (-3.46)         (-5.08)         (-4.17)   

doctors                                                           -0.0740         -0.0733         -0.0515   
                                                                  (-1.04)         (-1.03)         (-0.69)   

ipc                                                                0.0112         0.00160          -0.365***
                                                                   (1.63)          (0.18)         (-5.80)   

_cons               0.118***        0.113***        0.111***       -0.193***       -0.194***       -0.188***
                  (76.86)         (71.53)        (101.93)        (-28.14)        (-28.10)        (-25.23)   
------------------------------------------------------------------------------------------------------------
N                 2102431         2102431         2102431         2102136         2102136         2102136   
------------------------------------------------------------------------------------------------------------
t statistics in parentheses
* p<0.05, ** p<0.01, *** p<0.001

. 
. ********************************************************
. * Q.3
. 
. foreach x of var birth globo y_* {
  2. bysort amc_code: egen av_`x' = mean(`x')
  3. gen fe_`x' = `x' - av_`x'
  4. drop av_`x'
  5. }

. 
. // column 3
. areg birth globo i.year, cluster(amc_code) absorb(amc_code)

Linear regression, absorbing indicators         Number of obs     =  2,102,431
                                                F(  13,   3475)   =      86.58
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0143
                                                Adj R-squared     =     0.0126
                                                Root MSE          =     0.2968

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0075093   .0015493    -4.85   0.000     -.010547   -.0044717
             |
        year |
       1980  |   .0027071   .0013073     2.07   0.038     .0001441    .0052702
       1981  |   .0015965   .0011953     1.34   0.182    -.0007471    .0039401
       1982  |   .0008024   .0015604     0.51   0.607     -.002257    .0038618
       1983  |  -.0048828   .0013644    -3.58   0.000    -.0075578   -.0022077
       1984  |   -.009989   .0016121    -6.20   0.000    -.0131497   -.0068284
       1985  |  -.0126737   .0017507    -7.24   0.000    -.0161062   -.0092412
       1986  |  -.0145485   .0017098    -8.51   0.000    -.0179009   -.0111962
       1987  |  -.0163541   .0018849    -8.68   0.000    -.0200498   -.0126584
       1988  |  -.0192893   .0022628    -8.52   0.000    -.0237258   -.0148528
       1989  |  -.0225834   .0022148   -10.20   0.000    -.0269259   -.0182409
       1990  |  -.0290078   .0025485   -11.38   0.000    -.0340045   -.0240112
       1991  |  -.0290997   .0025526   -11.40   0.000    -.0341044    -.024095
             |
       _cons |   .1174068    .001068   109.94   0.000     .1153129    .1195007
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. reg fe_birth fe_globo fe_y_2-fe_y_13, cluster(amc_code)

Linear regression                               Number of obs     =  2,102,431
                                                F(13, 3475)       =      86.72
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0017
                                                Root MSE          =     .29655

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
    fe_birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    fe_globo |  -.0075093    .001548    -4.85   0.000    -.0105445   -.0044742
      fe_y_2 |   .0027071   .0013062     2.07   0.038     .0001462    .0052681
      fe_y_3 |   .0015965   .0011943     1.34   0.181    -.0007452    .0039382
      fe_y_4 |   .0008024   .0015591     0.51   0.607    -.0022545    .0038593
      fe_y_5 |  -.0048828   .0013633    -3.58   0.000    -.0075556   -.0022099
      fe_y_6 |   -.009989   .0016107    -6.20   0.000    -.0131471    -.006831
      fe_y_7 |  -.0126737   .0017493    -7.25   0.000    -.0161034   -.0092441
      fe_y_8 |  -.0145485   .0017084    -8.52   0.000    -.0178981    -.011199
      fe_y_9 |  -.0163541   .0018834    -8.68   0.000    -.0200467   -.0126615
     fe_y_10 |  -.0192893   .0022609    -8.53   0.000    -.0237221   -.0148564
     fe_y_11 |  -.0225834    .002213   -10.20   0.000    -.0269224   -.0182445
     fe_y_12 |  -.0290078   .0025464   -11.39   0.000    -.0340004   -.0240153
     fe_y_13 |  -.0290997   .0025505   -11.41   0.000    -.0341003   -.0240992
       _cons |  -5.47e-10   3.22e-10    -1.70   0.089    -1.18e-09    8.44e-11
------------------------------------------------------------------------------

. // we make an error with not adjusting the degrees of freedom
. // areg is taking care of this
. 
. // what about the "constant"
. 
. foreach x of var birth globo y_* {
  2. bysort amc_code: egen av_`x' = mean(`x')
  3. sum av_`x'
  4. gen fe2_`x' = `x' - av_`x' + r(mean)
  5. drop av_`x'
  6. }

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    av_birth |  2,102,431     .099022    .0335346          0   .3589744

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
    av_globo |  2,102,431     .731536    .3201637          0          1

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      av_y_1 |  2,102,431    .0643788    .0054158   .0217391   .1111111

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      av_y_2 |  2,102,431    .0664497     .004881   .0222222   .1111111

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      av_y_3 |  2,102,431    .0684907    .0042848    .025641   .1111111

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      av_y_4 |  2,102,431    .0705326    .0038088        .04   .1025641

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      av_y_5 |  2,102,431    .0726435    .0034298   .0322581   .1060606

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      av_y_6 |  2,102,431    .0748567    .0031096    .037037   .1060606

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      av_y_7 |  2,102,431    .0769267    .0029717    .037037   .1025641

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      av_y_8 |  2,102,431    .0787997    .0030606    .037037   .1066667

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
      av_y_9 |  2,102,431    .0808664    .0033226   .0434783   .1428571

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     av_y_10 |  2,102,431    .0831052    .0038628   .0454545   .1333333

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     av_y_11 |  2,102,431    .0853022    .0046135   .0508475   .1333333

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     av_y_12 |  2,102,431    .0876181    .0055361   .0508475   .1333333

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
     av_y_13 |  2,102,431    .0900296    .0066686   .0357143   .1428571

. areg birth globo i.year, cluster(amc_code) absorb(amc_code)

Linear regression, absorbing indicators         Number of obs     =  2,102,431
                                                F(  13,   3475)   =      86.58
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0143
                                                Adj R-squared     =     0.0126
                                                Root MSE          =     0.2968

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0075093   .0015493    -4.85   0.000     -.010547   -.0044717
             |
        year |
       1980  |   .0027071   .0013073     2.07   0.038     .0001441    .0052702
       1981  |   .0015965   .0011953     1.34   0.182    -.0007471    .0039401
       1982  |   .0008024   .0015604     0.51   0.607     -.002257    .0038618
       1983  |  -.0048828   .0013644    -3.58   0.000    -.0075578   -.0022077
       1984  |   -.009989   .0016121    -6.20   0.000    -.0131497   -.0068284
       1985  |  -.0126737   .0017507    -7.24   0.000    -.0161062   -.0092412
       1986  |  -.0145485   .0017098    -8.51   0.000    -.0179009   -.0111962
       1987  |  -.0163541   .0018849    -8.68   0.000    -.0200498   -.0126584
       1988  |  -.0192893   .0022628    -8.52   0.000    -.0237258   -.0148528
       1989  |  -.0225834   .0022148   -10.20   0.000    -.0269259   -.0182409
       1990  |  -.0290078   .0025485   -11.38   0.000    -.0340045   -.0240112
       1991  |  -.0290997   .0025526   -11.40   0.000    -.0341044    -.024095
             |
       _cons |   .1174068    .001068   109.94   0.000     .1153129    .1195007
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. reg fe2_birth fe2_globo fe2_y_2-fe2_y_13, cluster(amc_code)

Linear regression                               Number of obs     =  2,102,431
                                                F(12, 3475)       =          .
                                                Prob > F          =          .
                                                R-squared         =     0.0017
                                                Root MSE          =     .29655

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
   fe2_birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
   fe2_globo |  -.0075093    .001548    -4.85   0.000    -.0105445   -.0044742
     fe2_y_2 |   .0027071   .0013062     2.07   0.038     .0001462    .0052681
     fe2_y_3 |   .0015965   .0011943     1.34   0.181    -.0007452    .0039382
     fe2_y_4 |   .0008024   .0015591     0.51   0.607    -.0022545    .0038593
     fe2_y_5 |  -.0048828   .0013633    -3.58   0.000    -.0075556   -.0022099
     fe2_y_6 |   -.009989   .0016107    -6.20   0.000    -.0131471    -.006831
     fe2_y_7 |  -.0126737   .0017493    -7.25   0.000    -.0161034   -.0092441
     fe2_y_8 |  -.0145485   .0017084    -8.52   0.000    -.0178981    -.011199
     fe2_y_9 |  -.0163541   .0018834    -8.68   0.000    -.0200467   -.0126615
    fe2_y_10 |  -.0192893   .0022609    -8.53   0.000    -.0237221   -.0148564
    fe2_y_11 |  -.0225834    .002213   -10.20   0.000    -.0269224   -.0182445
    fe2_y_12 |  -.0290078   .0025464   -11.39   0.000    -.0340004   -.0240153
    fe2_y_13 |  -.0290997   .0025505   -11.41   0.000    -.0341003   -.0240992
       _cons |   .1174068   .0010671   110.03   0.000     .1153146    .1194989
------------------------------------------------------------------------------

. * now the constants match
. // technical note: fixed effect model does not have a constant!
. // areg reports something like an average fixed effect as constant
. 
. // aside: detour on fixed effects and dummies.  use column 1
. reg birth globo i.year, cluster(amc_code)

Linear regression                               Number of obs     =  2,102,431
                                                F(13, 3475)       =     150.18
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0031
                                                Root MSE          =     .29823

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0294689   .0037997    -7.76   0.000    -.0369187   -.0220191
             |
        year |
       1980  |   .0042427   .0013402     3.17   0.002      .001615    .0068704
       1981  |   .0074939   .0015331     4.89   0.000      .004488    .0104999
       1982  |   .0090262   .0019272     4.68   0.000     .0052476    .0128048
       1983  |   .0040452   .0018257     2.22   0.027     .0004656    .0076248
       1984  |  -.0006472   .0020252    -0.32   0.749    -.0046179    .0033235
       1985  |  -.0029818   .0021917    -1.36   0.174     -.007279    .0013154
       1986  |  -.0042063   .0022792    -1.85   0.065    -.0086749    .0002624
       1987  |  -.0048817   .0024057    -2.03   0.043    -.0095985    -.000165
       1988  |  -.0064706    .002765    -2.34   0.019    -.0118919   -.0010494
       1989  |  -.0089174   .0027286    -3.27   0.001    -.0142672   -.0035675
       1990  |  -.0146742   .0030414    -4.82   0.000    -.0206372   -.0087112
       1991  |  -.0143408   .0030832    -4.65   0.000    -.0203859   -.0082956
             |
       _cons |   .1237332   .0016002    77.33   0.000     .1205958    .1268705
------------------------------------------------------------------------------

. areg birth globo, cluster(amc_code) absorb(year)

Linear regression, absorbing indicators         Number of obs     =  2,102,431
                                                F(   1,   3475)   =      60.15
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0031
                                                Adj R-squared     =     0.0031
                                                Root MSE          =     0.2982

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0294689   .0037997    -7.76   0.000    -.0369187   -.0220191
       _cons |   .1205796   .0018284    65.95   0.000     .1169947    .1241645
-------------+----------------------------------------------------------------
        year |   absorbed                                      (13 categories)

. 
. 
. ********************************************************
. * Q.4
. // the LPM could predict values outside of the unit interval, i.e. prob. larger
. // than 1 or less than 0
. gen outofbounds = (pr_birth_6>1 | pr_birth_6<0)

. tab outofbounds

outofbounds |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  1,949,184       92.71       92.71
          1 |    153,247        7.29      100.00
------------+-----------------------------------
      Total |  2,102,431      100.00

. * for 7% of our predictions, we get nonsense results (but can't discard them)
. * would need to change models to get everything inside the unit interval
. 
. // goodness of fit
. gen gf_birth_6 = (pr_birth_6>0.5)

. // check correctness of the preditiction
. gen correct_6 = (gf_birth_6==birth)

. tab correct_6 if birth==0

  correct_6 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |        221        0.01        0.01
          1 |  1,894,023       99.99      100.00
------------+-----------------------------------
      Total |  1,894,244      100.00

. tab correct_6 if birth==1

  correct_6 |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |    208,113       99.96       99.96
          1 |         74        0.04      100.00
------------+-----------------------------------
      Total |    208,187      100.00

. 
. // terrible fit, but for this model we are not interested in the predictive 
. // power to get the zeros and ones correct, but rather want to understand
. // whether globo has an effect, i.e. the treatment effect of globo
. 
. 
. ********************************************************
. * Q.5 Interaction terms
. 
. gen globoXeduh = globo * yrsedu_head

. gen globoXedu = globo * yrs_edu

. gen globoXwealth = globo * wealth_noTV

. 
. areg birth globo globoXeduh $controls i.year [aweight = weight], ///
>  cluster(amc_code) absorb(amc_code)
(sum of wgt is 18522526.5012)

Linear regression, absorbing indicators         Number of obs     =  2,102,136
                                                F(  25,   3475)   =     646.00
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0496
                                                Adj R-squared     =     0.0480
                                                Root MSE          =     0.2847

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0101203   .0014065    -7.20   0.000    -.0128781   -.0073626
  globoXeduh |   .0013128   .0002238     5.86   0.000     .0008739    .0017517
         age |   .0230842   .0005466    42.23   0.000     .0220126    .0241558
        age2 |  -.0004206   .0000106   -39.84   0.000    -.0004413   -.0003999
       stock |   .0017513   .0006065     2.89   0.004     .0005621    .0029405
      stock2 |  -.0000256   .0000341    -0.75   0.453    -.0000924    .0000412
 yrsedu_head |  -.0012361   .0001336    -9.25   0.000    -.0014982   -.0009741
 wealth_noTV |  -.0203747   .0003389   -60.12   0.000    -.0210392   -.0197102
     married |   .0581047   .0011927    48.72   0.000     .0557663    .0604431
    catholic |  -.0033232    .000611    -5.44   0.000    -.0045212   -.0021252
       rural |  -.0049978   .0011523    -4.34   0.000    -.0072571   -.0027385
     doctors |  -.0411787    .074452    -0.55   0.580    -.1871528    .1047954
         ipc |  -.3677448   .0638671    -5.76   0.000    -.4929656   -.2425239
             |
        year |
       1980  |   .0017929   .0013341     1.34   0.179    -.0008228    .0044086
       1981  |   .0004956   .0012896     0.38   0.701    -.0020327     .003024
       1982  |  -.0009014    .001272    -0.71   0.479    -.0033953    .0015925
       1983  |  -.0063628   .0012591    -5.05   0.000    -.0088315   -.0038941
       1984  |  -.0098913    .001249    -7.92   0.000    -.0123401   -.0074424
       1985  |  -.0125473   .0013413    -9.35   0.000    -.0151771   -.0099175
       1986  |  -.0125856   .0013126    -9.59   0.000     -.015159   -.0100121
       1987  |  -.0140172   .0014481    -9.68   0.000    -.0168564   -.0111779
       1988  |  -.0156529   .0014169   -11.05   0.000     -.018431   -.0128748
       1989  |  -.0167139   .0014466   -11.55   0.000    -.0195501   -.0138776
       1990  |  -.0215713   .0014831   -14.54   0.000    -.0244791   -.0186636
       1991  |  -.0201851    .001546   -13.06   0.000    -.0232162    -.017154
             |
       _cons |  -.1826011    .007112   -25.68   0.000    -.1965452    -.168657
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

.  est store intl

. 
.  // HOMEWORK: add the other two columns; add some interpretations
.  // for the interactions, e.g. compute the thresholds, argue about 
.  // heterogenous effects, etc.
.  * when birth rate declines in quadratic age model
.  
.  // Column 2, pay attention to the controls
. global controls2 "age age2 stock stock2 yrs_edu wealth_noTV married catholic rural doctors ipc"

.  
. areg birth globo globoXedu $controls2 i.year [aweight = weight], ///
>  cluster(amc_code) absorb(amc_code)
(sum of wgt is 18522526.5012)

Linear regression, absorbing indicators         Number of obs     =  2,102,136
                                                F(  25,   3475)   =     697.80
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0509
                                                Adj R-squared     =     0.0493
                                                Root MSE          =     0.2845

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0130126   .0014543    -8.95   0.000    -.0158639   -.0101612
   globoXedu |   .0017959   .0001578    11.38   0.000     .0014864    .0021054
         age |   .0235095   .0005385    43.66   0.000     .0224537    .0245653
        age2 |  -.0004297   .0000105   -40.83   0.000    -.0004503    -.000409
       stock |  -.0003003   .0006167    -0.49   0.626    -.0015094    .0009088
      stock2 |   .0000811   .0000351     2.31   0.021     .0000123    .0001499
     yrs_edu |  -.0044216   .0001481   -29.86   0.000    -.0047119   -.0041313
 wealth_noTV |  -.0161248   .0003583   -45.00   0.000    -.0168273   -.0154223
     married |   .0589466   .0012631    46.67   0.000     .0564701    .0614231
    catholic |  -.0036575   .0005843    -6.26   0.000    -.0048031   -.0025119
       rural |  -.0051745   .0011498    -4.50   0.000    -.0074288   -.0029203
     doctors |   .0977745   .0725812     1.35   0.178    -.0445315    .2400805
         ipc |  -.3568823   .0663231    -5.38   0.000    -.4869184   -.2268461
             |
        year |
       1980  |   .0022098   .0013282     1.66   0.096    -.0003943     .004814
       1981  |   .0012974   .0013017     1.00   0.319    -.0012549    .0038497
       1982  |   .0002357   .0012502     0.19   0.850    -.0022156    .0026869
       1983  |  -.0049236   .0012753    -3.86   0.000     -.007424   -.0024233
       1984  |  -.0081822    .001236    -6.62   0.000    -.0106055   -.0057589
       1985  |  -.0105865   .0013186    -8.03   0.000    -.0131718   -.0080012
       1986  |   -.010389    .001308    -7.94   0.000    -.0129536   -.0078243
       1987  |  -.0116322   .0014496    -8.02   0.000    -.0144744   -.0087899
       1988  |  -.0131387    .001389    -9.46   0.000     -.015862   -.0104153
       1989  |  -.0141081   .0014254    -9.90   0.000    -.0169029   -.0113133
       1990  |  -.0188838   .0014667   -12.87   0.000    -.0217595    -.016008
       1991  |  -.0175069   .0015365   -11.39   0.000    -.0205194   -.0144943
             |
       _cons |  -.1685594   .0069142   -24.38   0.000    -.1821157   -.1550032
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. est store int2

.  
. // Column 3
. areg birth globo globoXwealth $controls i.year [aweight = weight], ///
>  cluster(amc_code) absorb(amc_code)
(sum of wgt is 18522526.5012)

Linear regression, absorbing indicators         Number of obs     =  2,102,136
                                                F(  25,   3475)   =     598.53
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0495
                                                Adj R-squared     =     0.0479
                                                Root MSE          =     0.2848

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0043063   .0012616    -3.41   0.001    -.0067799   -.0018327
globoXwealth |   .0018452   .0005367     3.44   0.001      .000793    .0028974
         age |   .0231254    .000552    41.89   0.000     .0220431    .0242078
        age2 |  -.0004211   .0000106   -39.57   0.000     -.000442   -.0004003
       stock |   .0017562   .0006067     2.89   0.004     .0005667    .0029458
      stock2 |  -.0000234   .0000341    -0.69   0.492    -.0000902    .0000434
 yrsedu_head |  -.0001828   .0001182    -1.55   0.122    -.0004144    .0000489
 wealth_noTV |  -.0217961   .0004826   -45.16   0.000    -.0227424   -.0208498
     married |   .0580859   .0011946    48.62   0.000     .0557436    .0604282
    catholic |  -.0033198   .0006084    -5.46   0.000    -.0045127    -.002127
       rural |  -.0049555   .0011483    -4.32   0.000     -.007207    -.002704
     doctors |  -.0495706   .0748048    -0.66   0.508    -.1962363    .0970951
         ipc |  -.3700222   .0644096    -5.74   0.000    -.4963066   -.2437377
             |
        year |
       1980  |   .0018025   .0013396     1.35   0.179     -.000824     .004429
       1981  |   .0004046   .0012887     0.31   0.754    -.0021222    .0029314
       1982  |  -.0010336   .0012726    -0.81   0.417    -.0035287    .0014616
       1983  |  -.0065122   .0012534    -5.20   0.000    -.0089697   -.0040547
       1984  |  -.0100467   .0012511    -8.03   0.000    -.0124997   -.0075938
       1985  |  -.0127074   .0013399    -9.48   0.000    -.0153344   -.0100804
       1986  |  -.0127489   .0013132    -9.71   0.000    -.0153236   -.0101743
       1987  |  -.0141839   .0014444    -9.82   0.000    -.0170159   -.0113518
       1988  |  -.0157599   .0014154   -11.13   0.000     -.018535   -.0129847
       1989  |  -.0168103   .0014459   -11.63   0.000    -.0196453   -.0139753
       1990  |  -.0216756   .0014841   -14.61   0.000    -.0245854   -.0187659
       1991  |  -.0202946   .0015484   -13.11   0.000    -.0233305   -.0172587
             |
       _cons |  -.1876875   .0074294   -25.26   0.000    -.2022539   -.1731211
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. est store int3

. 
. /* Comment 
> 1) The quadatic terms for age and stock of children allow for turning points
> in expected births once the age levels and numbers of children rise beyond
> the turning point or threshold.  First we check to make sure the signs of the
> coefficients for age and age^2 changes and then we can calc the turning point
> as B1/(2*B2).  Here the turning point for age is .0230842/(2*.0004206) = 27.4
> years old.  So the probability of giving birth in any given year will rise with
> age until 27 years old, then the probability will begin declining.
> For # of children, the turning point is  .0017513/(2*.0000256) = 34 which really
> isn't a significant measure. For column 2 where we control for the mother's 
> education level instead the effect is reverse - we expect a lower probability
> of giving birth at first until the turning point of 1.85 children.  So once 
> a woman has 2 children say, it becomes slightly more likely she will have a 
> 3rd child this year.  
> 
> 2) We've added three interaction terms here - Globo TV coverage area combined
> with # years of education for the head of household, for the woman and finally
> with a wealth index.  We are trying to see if the years of education and wealth
> levels has any impact in terms of increasing or reducing the effect on fertility
> that globo has.  That is, does more education or wealth lead to a less strong 
> effect of globo coverage on birth probability ("fertility")?
> 
> For column 2, the effect of globo coverage reduces the probability of birth in 
> the year by the coefficient of globo of -.013, which is the effect assuming
> that the woman has 0 years of education.  
> 
> So this effect is mitigated by the  years of education that the woman has 
> (coefficient of .0018 * # years).  If  a woman only has 1 year of education, 
> then the negative effect of Globo on fertility is reduced 
> to -0.013 + (.0018*1 year) = -0.011 or 1.1% reduction (and not 1.3% reduction).
> At some point, enough education fully eliminates the effect of Globo on 
> fertility.  This is foundas follows: the coefficient on globo / the coefficient 
> on the interaction term, or -.013/.0018 = 7.22 years.  Since education is 
> measured as a discrete variable, once a woman attains 8 years of education,
> then we expect the effect of globo on fertility to be reduced to zero.
> Thus, more educated women's fertility is less impacted by Globo.
> 
> For column 3, we introduce wealth as the interaction term.  We want to test to
> see if higher wealth levels reduce the impact of Globo's negative impact on 
> fertility.  Wealth is an index variable.  The paper quotes effects based on
> 20th percentile and 80th perecentile wealth levels.  Calculate those here now:
> */
. 
. * set up percentile breaks (use 5 to get 20%, 40%, etc.)
.  _pctile wealth_noTV, nquantiles(5)

.  * display the results
.  return list

scalars:
                 r(r1) =  -1.562857031822205
                 r(r2) =  .1055497825145721
                 r(r3) =  1.131624579429627
                 r(r4) =  1.131624579429627

.  /* So r(r1) = 20th perecentile which is -1.563.  The effect of Globo taking
>  into account this 20th percentile wealth index level is thus calculated as:
>  -0.0043 + .0018*(-1.563) = -0.007 or a .7% decline in fertility for those at 
>  the 20th percentile ranking in wealth (so poorer than average).
>  
>  Now r(r4) = 80th percentile whic is 1.132, and inserting this into the same
>  equation above, the negative effect of Globo on fertility is reduced to only
>  0.2%.  So a higher wealth level means that Globo access has less of a negative
>  impact on fertility.  Those that are poorer will be more impacted by Globo.
>  
>  The paper hypothesizes that richer people, and more educated people are more 
>  likely to have had other exposure to role models with smaller family size,
>  so Globo soap opera's would have less effect on them.
>  */
. 
.  
. ********************************************************
. * Q.6 Output tables, columns 4-6 from exercise 2
. 
. ssc install outreg2
checking outreg2 consistency and verifying not already installed...
all files already exist and are up to date.

. // estout outreg outreg2 packages, lyx is nice program for latex editing
.  
. est restore e4 
(results e4 are active now)

. outreg2 using "$workdir/leonard_table9", replace label nonotes ///
>   title(Table 2 - Globo Coverage and Fertility, Panel B) ///
>   drop(i.year) dec(4) asterisk(se) ctitle([4]) ///
>   addnote(Notes: Table reports OLS coefficients.  Standard errors in ///
> parenthesis are corrected for clustering at the AMC level.  AMC stands for ///
> Minimally Comparable Area and is a geographic aggregate slightly broader ///
> than a municipality.,*** Significant at the 1 percent level., ///
> ** Significant at the 5 percent level., ///
> * Significant at the 10 percent level. ) ///
>  addtext(Year Fixed Effects, Yes, Area Fixed Effects, No) ///
>   word 
C:\Users\roble\Desktop\Working\STATA\HW 7/leonard_table9.rtf
dir : seeout

.  
. // HOMEWORK: add e5 and e6 (using the append option instead of repalce), use
. // labels, titles, add notes, etc.  Try to produce a super nice table!  
. est restore e5 
(results e5 are active now)

. outreg2 using "$workdir/leonard_table9", append label nonotes ///
>   drop(i.year) dec(4) asterisk(se) ctitle([5]) ///
> addtext(Year Fixed Effects, Yes, Area Fixed Effects, State) ///
>  word
C:\Users\roble\Desktop\Working\STATA\HW 7/leonard_table9.rtf
dir : seeout

. 
. * column 6
. est restore e6 
(results e6 are active now)

. outreg2 using "$workdir/leonard_table9", append label nonotes ///
>   drop(i.year) dec(4) asterisk(se) ctitle([6]) ///
> addtext(Year Fixed Effects, Yes, Area Fixed Effects, AMC) ///
>  word
C:\Users\roble\Desktop\Working\STATA\HW 7/leonard_table9.rtf
dir : seeout

. 
. * Note: outreg2 doesn't seem to have text justification options - the help file 
. * refers the user to word.  Also can't seem to find an option to delete the 
. * automatic column numbering and the word "Variables" from the column header,
. * so this was done in word as well.
.  
.  
. * close the log file 
. log close
      name:  <unnamed>
       log:  C:\Users\roble\Desktop\Working\STATA\HW 7/leonard_exc7.log
  log type:  text
 closed on:  10 Dec 2017, 17:30:42
-------------------------------------------------------------------------------------------------------------------------------------------------------------
