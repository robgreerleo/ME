----------------------------------------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\roble\Desktop\Working\STATA\HW 8/leonard_exc8.log
  log type:  text
 opened on:  15 Dec 2017, 19:46:24

. 
. ********************************************************
. * Q.1 Collapsing the dataset and the district level
. 
. use "$datadir/LCD_new", clear

. 
. xtset id year
       panel variable:  id (unbalanced)
        time variable:  year, 1979 to 1991
                delta:  1 unit

. xtdes

      id:  3, 4, ..., 510301                                 n =     249957
    year:  1979, 1980, ..., 1991                             T =         13
           Delta(year) = 1 unit
           Span(year)  = 13 periods
           (id*year uniquely identifies each observation)

Distribution of T_i:   min      5%     25%       50%       75%     95%     max
                         1       2       6        12        13      13      13

     Freq.  Percent    Cum. |  Pattern
 ---------------------------+---------------
   121273     48.52   48.52 |  1111111111111
     9389      3.76   52.27 |  ............1
     9018      3.61   55.88 |  ...........11
     8436      3.37   59.26 |  ..........111
     8415      3.37   62.62 |  .........1111
     7888      3.16   65.78 |  ........11111
     7723      3.09   68.87 |  ......1111111
     7716      3.09   71.96 |  .....11111111
     7702      3.08   75.04 |  .......111111
    62397     24.96  100.00 | (other patterns)
 ---------------------------+---------------
   249957    100.00         |  XXXXXXXXXXXXX

. 
. global controls "age age2 stock stock2 yrsedu_head wealth_noTV married catholic rural doctors ipc"

. * drop large districts
. drop if large!=0
(300,250 observations deleted)

. gen n = 1

. * need to add the weights (otherwise we'd oversample wrong areas, etc)
. collapse (mean) birth globo $controls (sum) pop = n [aweight=weight] ///
> , by(uf_code amc_code year) 

. * generate variable that takes different values for all amc codes
. egen amc = group(amc_code)

. 
. // set panel dataset, must specify level of variation
. xtset amc year
       panel variable:  amc (strongly balanced)
        time variable:  year, 1979 to 1991
                delta:  1 unit

. * check balancing
. xtdes

     amc:  1, 2, ..., 3476                                   n =       3476
    year:  1979, 1980, ..., 1991                             T =         13
           Delta(year) = 1 unit
           Span(year)  = 13 periods
           (amc*year uniquely identifies each observation)

Distribution of T_i:   min      5%     25%       50%       75%     95%     max
                        13      13      13        13        13      13      13

     Freq.  Percent    Cum. |  Pattern
 ---------------------------+---------------
     3476    100.00  100.00 |  1111111111111
 ---------------------------+---------------
     3476    100.00         |  XXXXXXXXXXXXX

. 
. ********************************************************
. * Q.2 Re-run the model for the regional level regressions
. * column 3
. areg birth globo i.year, absorb(amc_code) cluster(amc_code)

Linear regression, absorbing indicators         Number of obs     =     45,188
                                                F(  13,   3475)   =      54.67
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2159
                                                Adj R-squared     =     0.1503
                                                Root MSE          =     0.0882

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |   -.002378   .0017122    -1.39   0.165     -.005735     .000979
             |
        year |
       1980  |   .0040452   .0024438     1.66   0.098    -.0007463    .0088366
       1981  |   .0008636    .002398     0.36   0.719    -.0038379    .0055652
       1982  |  -.0012961   .0024981    -0.52   0.604     -.006194    .0036018
       1983  |  -.0040797   .0024527    -1.66   0.096    -.0088887    .0007292
       1984  |  -.0115878   .0025094    -4.62   0.000    -.0165078   -.0066677
       1985  |  -.0151756   .0025098    -6.05   0.000    -.0200965   -.0102547
       1986  |  -.0171971   .0025109    -6.85   0.000    -.0221202   -.0122741
       1987  |  -.0166778   .0026257    -6.35   0.000    -.0218258   -.0115298
       1988  |  -.0229289   .0026068    -8.80   0.000      -.02804   -.0178178
       1989  |  -.0268579   .0026222   -10.24   0.000    -.0319991   -.0217167
       1990  |  -.0317856   .0026622   -11.94   0.000    -.0370053   -.0265659
       1991  |  -.0334077   .0026367   -12.67   0.000    -.0385773   -.0282382
             |
       _cons |     .13172   .0016564    79.52   0.000     .1284724    .1349677
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. est store e3a

. * add controls, column 6
. areg birth globo $controls i.year, absorb(amc_code) cluster(amc_code)

Linear regression, absorbing indicators         Number of obs     =     45,188
                                                F(  24,   3475)   =      57.20
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2506
                                                Adj R-squared     =     0.1877
                                                Root MSE          =     0.0862

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0015655    .001668    -0.94   0.348    -.0048358    .0017048
         age |   .0507963   .0024112    21.07   0.000     .0460688    .0555237
        age2 |  -.0007157   .0000361   -19.80   0.000    -.0007865   -.0006448
       stock |  -.0723424   .0049814   -14.52   0.000    -.0821091   -.0625756
      stock2 |   .0032803   .0003133    10.47   0.000      .002666    .0038946
 yrsedu_head |  -.0019718   .0028524    -0.69   0.489    -.0075643    .0036207
 wealth_noTV |  -.0214739   .0087684    -2.45   0.014    -.0386656   -.0042821
     married |   .1203213   .0154175     7.80   0.000      .090093    .1505496
    catholic |   .0224631   .0186302     1.21   0.228    -.0140642    .0589904
       rural |  -.0041378   .0240199    -0.17   0.863    -.0512324    .0429568
     doctors |  -2.283865   1.743257    -1.31   0.190    -5.701776    1.134047
         ipc |  -.5230551   .1891079    -2.77   0.006    -.8938289   -.1522812
             |
        year |
       1980  |    .003441    .002392     1.44   0.150    -.0012489     .008131
       1981  |  -.0004398    .002373    -0.19   0.853    -.0050924    .0042128
       1982  |  -.0031458   .0024753    -1.27   0.204    -.0079991    .0017075
       1983  |  -.0063656   .0024909    -2.56   0.011    -.0112493   -.0014819
       1984  |  -.0140051   .0026237    -5.34   0.000    -.0191492   -.0088611
       1985  |  -.0176943   .0028011    -6.32   0.000    -.0231864   -.0122023
       1986  |  -.0205175   .0029295    -7.00   0.000    -.0262612   -.0147737
       1987  |  -.0202887   .0031493    -6.44   0.000    -.0264634    -.014114
       1988  |  -.0257683   .0032574    -7.91   0.000    -.0321549   -.0193818
       1989  |  -.0290818   .0035498    -8.19   0.000    -.0360417   -.0221218
       1990  |  -.0332729   .0036718    -9.06   0.000    -.0404721   -.0260737
       1991  |   -.034108   .0040126    -8.50   0.000    -.0419754   -.0262406
             |
       _cons |  -.6420561   .0392132   -16.37   0.000    -.7189392   -.5651729
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. est store e6a

. * Rerun, weighted by population, column 3
. areg birth globo i.year [aweight=pop], absorb(amc_code) cluster(amc_code)
(sum of wgt is 2102431)

Linear regression, absorbing indicators         Number of obs     =     45,188
                                                F(  13,   3475)   =      83.87
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3435
                                                Adj R-squared     =     0.2886
                                                Root MSE          =     0.0494

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0057801   .0014813    -3.90   0.000    -.0086843   -.0028759
             |
        year |
       1980  |   .0031617   .0012976     2.44   0.015     .0006177    .0057058
       1981  |   .0016081   .0012919     1.24   0.213    -.0009249    .0041411
       1982  |   .0004045   .0016648     0.24   0.808    -.0028597    .0036686
       1983  |  -.0055353     .00136    -4.07   0.000    -.0082017   -.0028688
       1984  |  -.0100723   .0016112    -6.25   0.000    -.0132313   -.0069133
       1985  |  -.0133948   .0018106    -7.40   0.000    -.0169446   -.0098449
       1986  |  -.0143276   .0017173    -8.34   0.000    -.0176946   -.0109607
       1987  |   -.016452   .0017538    -9.38   0.000    -.0198906   -.0130134
       1988  |  -.0197292   .0021488    -9.18   0.000    -.0239423    -.015516
       1989  |  -.0224846   .0020866   -10.78   0.000    -.0265756   -.0183935
       1990  |  -.0282286   .0023088   -12.23   0.000    -.0327553   -.0237019
       1991  |  -.0286091   .0023479   -12.18   0.000    -.0332126   -.0240057
             |
       _cons |    .113823   .0010782   105.57   0.000     .1117091     .115937
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. est store e3b

. * again add controls, column 6
. areg birth globo $controls i.year [aweight=pop], absorb(amc_code) cluster(amc_code)
(sum of wgt is 2102431)

Linear regression, absorbing indicators         Number of obs     =     45,188
                                                F(  24,   3475)   =     112.34
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3749
                                                Adj R-squared     =     0.3224
                                                Root MSE          =     0.0482

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0037773   .0012488    -3.02   0.003    -.0062257   -.0013288
         age |   .0513631   .0017409    29.50   0.000     .0479499    .0547763
        age2 |  -.0007299   .0000264   -27.62   0.000    -.0007817   -.0006781
       stock |  -.0727107   .0035299   -20.60   0.000    -.0796317   -.0657898
      stock2 |   .0033553   .0002705    12.40   0.000     .0028249    .0038857
 yrsedu_head |  -.0028944   .0016542    -1.75   0.080    -.0061376    .0003488
 wealth_noTV |  -.0272235   .0051058    -5.33   0.000    -.0372343   -.0172128
     married |    .128009    .009779    13.09   0.000     .1088359    .1471821
    catholic |   .0053973   .0149813     0.36   0.719    -.0239758    .0347704
       rural |  -.0399425   .0132434    -3.02   0.003    -.0659082   -.0139769
     doctors |  -1.126101   1.205561    -0.93   0.350    -3.489781     1.23758
         ipc |   -.400826   .1019346    -3.93   0.000    -.6006838   -.2009682
             |
        year |
       1980  |   .0013086   .0013197     0.99   0.321    -.0012789    .0038961
       1981  |  -.0012091   .0013326    -0.91   0.364    -.0038218    .0014036
       1982  |  -.0030696    .001377    -2.23   0.026    -.0057694   -.0003699
       1983  |  -.0093834   .0013571    -6.91   0.000    -.0120442   -.0067227
       1984  |  -.0140587   .0014664    -9.59   0.000    -.0169339   -.0111836
       1985  |  -.0175838   .0016584   -10.60   0.000    -.0208352   -.0143323
       1986  |  -.0191129   .0017361   -11.01   0.000    -.0225168   -.0157089
       1987  |   -.021353   .0019307   -11.06   0.000    -.0251385   -.0175675
       1988  |   -.024284   .0022006   -11.04   0.000    -.0285986   -.0199693
       1989  |  -.0265418   .0023199   -11.44   0.000    -.0310904   -.0219932
       1990  |  -.0320713   .0024774   -12.95   0.000    -.0369286   -.0272139
       1991  |  -.0316321   .0026981   -11.72   0.000    -.0369222    -.026342
             |
       _cons |  -.6227536    .027918   -22.31   0.000     -.677491   -.5680162
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. est store e6b

. 
. //compare the results
. esttab e3a e3b e6a e6b, b(%9.4f) se(%9.4f) stat(N r2) drop(*.year) label

------------------------------------------------------------------------------------
                              (1)             (2)             (3)             (4)   
                     (mean) birth    (mean) birth    (mean) birth    (mean) birth   
------------------------------------------------------------------------------------
(mean) globo              -0.0024         -0.0058***      -0.0016         -0.0038** 
                         (0.0017)        (0.0015)        (0.0017)        (0.0012)   

(mean) age                                                 0.0508***       0.0514***
                                                         (0.0024)        (0.0017)   

(mean) age2                                               -0.0007***      -0.0007***
                                                         (0.0000)        (0.0000)   

(mean) stock                                              -0.0723***      -0.0727***
                                                         (0.0050)        (0.0035)   

(mean) stock2                                              0.0033***       0.0034***
                                                         (0.0003)        (0.0003)   

(mean) yrsedu_head                                        -0.0020         -0.0029   
                                                         (0.0029)        (0.0017)   

(mean) wealth_noTV                                        -0.0215*        -0.0272***
                                                         (0.0088)        (0.0051)   

(mean) married                                             0.1203***       0.1280***
                                                         (0.0154)        (0.0098)   

(mean) catholic                                            0.0225          0.0054   
                                                         (0.0186)        (0.0150)   

(mean) rural                                              -0.0041         -0.0399** 
                                                         (0.0240)        (0.0132)   

(mean) doctors                                            -2.2839         -1.1261   
                                                         (1.7433)        (1.2056)   

(mean) ipc                                                -0.5231**       -0.4008***
                                                         (0.1891)        (0.1019)   

Constant                   0.1317***       0.1138***      -0.6421***      -0.6228***
                         (0.0017)        (0.0011)        (0.0392)        (0.0279)   
------------------------------------------------------------------------------------
N                        4.52e+04        4.52e+04        4.52e+04        4.52e+04   
r2                         0.2159          0.3435          0.2506          0.3749   
------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.05, ** p<0.01, *** p<0.001

. /* The first sets are underestimations compared to the paper.  We aren't
> including weighting here, so we don't have the correct sample for comparison.
> The second set includes weighting factors giving more weight to districts with
> higher populations. The results are in line with what the paper describes.
> So the first set results in statistically insignificant results and lower 
> coefficients while the second set results in much higher coefficients and
> statistically significant results.  So the conlcusion of the paper that TV
> coverage of soap operas reduces births is only true when we apply the weighting
> factors.  The effects of globo is stronger in districts with more population.
> So the coefficient is not evenly distributed across district population size.
> Split the sample to show this further:  
> */
. 
. // split the sample into more and less populous districts
. sum pop, detail 

                           (sum) n
-------------------------------------------------------------
      Percentiles      Smallest
 1%            3              1
 5%            6              1
10%            8              1       Obs              45,188
25%           12              1       Sum of Wgt.      45,188

50%           20                      Mean           46.52631
                        Largest       Std. Dev.      268.6934
75%           31          12902
90%           64          13121       Variance       72196.16
95%          113          13324       Skewness       33.26981
99%          459          13530       Kurtosis       1371.236

. scalar median = r(p50)

. 
. areg birth globo $controls i.year if pop<median, absorb(amc_code) cluster(amc_code)

Linear regression, absorbing indicators         Number of obs     =     22,468
                                                F(  24,   2164)   =      21.42
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2324
                                                Adj R-squared     =     0.1496
                                                Root MSE          =     0.1085

                           (Std. Err. adjusted for 2,165 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0003664   .0030567    -0.12   0.905    -.0063607    .0056279
         age |   .0525012   .0032543    16.13   0.000     .0461194    .0588831
        age2 |  -.0007308   .0000483   -15.15   0.000    -.0008254   -.0006361
       stock |  -.0763259   .0066064   -11.55   0.000    -.0892816   -.0633703
      stock2 |   .0035013   .0004027     8.69   0.000     .0027116     .004291
 yrsedu_head |   -.001865   .0037506    -0.50   0.619    -.0092202    .0054901
 wealth_noTV |  -.0197092   .0114301    -1.72   0.085    -.0421243    .0027059
     married |   .1177444   .0204409     5.76   0.000     .0776587    .1578302
    catholic |   .0401572   .0250505     1.60   0.109    -.0089683    .0892827
       rural |   .0045151   .0303408     0.15   0.882    -.0549852    .0640153
     doctors |  -7.257156   2.640393    -2.75   0.006    -12.43513   -2.079184
         ipc |  -14.64292   112.7694    -0.13   0.897    -235.7906    206.5048
             |
        year |
       1980  |   .0027702   .0038458     0.72   0.471    -.0047717     .010312
       1981  |  -.0009452   .0038467    -0.25   0.806    -.0084887    .0065984
       1982  |  -.0036068   .0040709    -0.89   0.376      -.01159    .0043765
       1983  |  -.0045385   .0041256    -1.10   0.271    -.0126291    .0035521
       1984  |  -.0143394   .0043122    -3.33   0.001    -.0227958    -.005883
       1985  |  -.0181808   .0046184    -3.94   0.000    -.0272378   -.0091237
       1986  |  -.0205659   .0047489    -4.33   0.000    -.0298789   -.0112529
       1987  |  -.0205131    .005156    -3.98   0.000    -.0306244   -.0104018
       1988  |  -.0269537   .0052467    -5.14   0.000    -.0372428   -.0166646
       1989  |  -.0269315   .0057263    -4.70   0.000    -.0381612   -.0157018
       1990  |  -.0303042   .0058956    -5.14   0.000    -.0418658   -.0187425
       1991  |  -.0360831   .0063196    -5.71   0.000    -.0484762     -.02369
             |
       _cons |  -.6875608   .0542887   -12.66   0.000    -.7940242   -.5810974
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (2165 categories)

. est store e3a_alt1

. 
. areg birth globo $controls i.year if pop>median, absorb(amc_code) cluster(amc_code)

Linear regression, absorbing indicators         Number of obs     =     22,371
                                                F(  24,   2157)   =      59.34
                                                Prob > F          =     0.0000
                                                R-squared         =     0.3542
                                                Adj R-squared     =     0.2845
                                                Root MSE          =     0.0559

                           (Std. Err. adjusted for 2,158 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0029397   .0015592    -1.89   0.060    -.0059973     .000118
         age |   .0541221   .0029176    18.55   0.000     .0484006    .0598436
        age2 |  -.0007679    .000044   -17.43   0.000    -.0008543   -.0006816
       stock |   -.082673   .0066814   -12.37   0.000    -.0957756   -.0695705
      stock2 |   .0038218    .000557     6.86   0.000     .0027296    .0049141
 yrsedu_head |  -.0052401    .002651    -1.98   0.048    -.0104388   -.0000414
 wealth_noTV |  -.0161475   .0080037    -2.02   0.044    -.0318432   -.0004518
     married |   .1181384   .0166442     7.10   0.000      .085498    .1507787
    catholic |   -.013378   .0226964    -0.59   0.556     -.057887     .031131
       rural |  -.0430326   .0221929    -1.94   0.053    -.0865542     .000489
     doctors |   .2967412   1.314439     0.23   0.821    -2.280959    2.874441
         ipc |  -.4807063   .1466253    -3.28   0.001     -.768248   -.1931646
             |
        year |
       1980  |   .0039384   .0023934     1.65   0.100    -.0007552     .008632
       1981  |  -.0016371   .0023424    -0.70   0.485    -.0062306    .0029565
       1982  |  -.0041005   .0025413    -1.61   0.107    -.0090841    .0008831
       1983  |  -.0093743   .0025235    -3.71   0.000     -.014323   -.0044256
       1984  |  -.0138986   .0027129    -5.12   0.000    -.0192187   -.0085784
       1985  |  -.0181058   .0027729    -6.53   0.000    -.0235436   -.0126679
       1986  |  -.0214588   .0030867    -6.95   0.000    -.0275121   -.0154056
       1987  |   -.021201   .0032364    -6.55   0.000    -.0275478   -.0148542
       1988  |  -.0263111   .0034727    -7.58   0.000    -.0331213   -.0195008
       1989  |  -.0326553   .0036835    -8.87   0.000    -.0398788   -.0254318
       1990  |  -.0377818   .0040395    -9.35   0.000    -.0457035   -.0298601
       1991  |  -.0360557   .0043868    -8.22   0.000    -.0446585   -.0274528
             |
       _cons |  -.6100286   .0438684   -13.91   0.000    -.6960574   -.5239997
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (2158 categories)

. est store e3a_alt2

. // compare the results
. esttab e3a_alt1 e3a_alt2, b(%9.4f) se(%9.4f) stat(N r2) drop(*.year) label

----------------------------------------------------
                              (1)             (2)   
                     (mean) birth    (mean) birth   
----------------------------------------------------
(mean) globo              -0.0004         -0.0029   
                         (0.0031)        (0.0016)   

(mean) age                 0.0525***       0.0541***
                         (0.0033)        (0.0029)   

(mean) age2               -0.0007***      -0.0008***
                         (0.0000)        (0.0000)   

(mean) stock              -0.0763***      -0.0827***
                         (0.0066)        (0.0067)   

(mean) stock2              0.0035***       0.0038***
                         (0.0004)        (0.0006)   

(mean) yrsedu_head        -0.0019         -0.0052*  
                         (0.0038)        (0.0027)   

(mean) wealth_noTV        -0.0197         -0.0161*  
                         (0.0114)        (0.0080)   

(mean) married             0.1177***       0.1181***
                         (0.0204)        (0.0166)   

(mean) catholic            0.0402         -0.0134   
                         (0.0251)        (0.0227)   

(mean) rural               0.0045         -0.0430   
                         (0.0303)        (0.0222)   

(mean) doctors            -7.2572**        0.2967   
                         (2.6404)        (1.3144)   

(mean) ipc               -14.6429         -0.4807** 
                       (112.7694)        (0.1466)   

Constant                  -0.6876***      -0.6100***
                         (0.0543)        (0.0439)   
----------------------------------------------------
N                        2.25e+04        2.24e+04   
r2                         0.2324          0.3542   
----------------------------------------------------
Standard errors in parentheses
* p<0.05, ** p<0.01, *** p<0.001

. 
. 
. ********************************************************
. * Q.3 Compare Standard errors
. 
. reg birth globo $controls i.year

      Source |       SS           df       MS      Number of obs   =    45,188
-------------+----------------------------------   F(24, 45163)    =    274.28
       Model |  52.6093852        24  2.19205772   Prob > F        =    0.0000
    Residual |  360.946824    45,163  .007992091   R-squared       =    0.1272
-------------+----------------------------------   Adj R-squared   =    0.1267
       Total |   413.55621    45,187  .009152106   Root MSE        =     .0894

------------------------------------------------------------------------------
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0038792   .0010343    -3.75   0.000    -.0059064   -.0018521
         age |   .0294448   .0011247    26.18   0.000     .0272403    .0316493
        age2 |   -.000561   .0000177   -31.69   0.000    -.0005957   -.0005263
       stock |   .0169181   .0012679    13.34   0.000     .0144329    .0194032
      stock2 |  -.0005927   .0000993    -5.97   0.000    -.0007874    -.000398
 yrsedu_head |  -.0011143    .000416    -2.68   0.007    -.0019296    -.000299
 wealth_noTV |  -.0206505   .0007918   -26.08   0.000    -.0222024   -.0190987
     married |   .0411112   .0028487    14.43   0.000     .0355277    .0466947
    catholic |  -.0009844   .0038028    -0.26   0.796     -.008438    .0064692
       rural |  -.0087638   .0023711    -3.70   0.000    -.0134113   -.0041163
     doctors |   -.191716    .296388    -0.65   0.518    -.7726414    .3892095
         ipc |   .1417578   .1301659     1.09   0.276    -.1133696    .3968851
             |
        year |
       1980  |   .0046922   .0021448     2.19   0.029     .0004883    .0088961
       1981  |   .0020658   .0021638     0.95   0.340    -.0021753     .006307
       1982  |   .0008219   .0021942     0.37   0.708    -.0034788    .0051226
       1983  |  -.0011826   .0022094    -0.54   0.592    -.0055131     .003148
       1984  |  -.0075159   .0022186    -3.39   0.001    -.0118643   -.0031675
       1985  |  -.0100789   .0022277    -4.52   0.000    -.0144452   -.0057126
       1986  |  -.0116843   .0022446    -5.21   0.000    -.0160837   -.0072849
       1987  |  -.0098917   .0022722    -4.35   0.000    -.0143453   -.0054381
       1988  |  -.0146092   .0022961    -6.36   0.000    -.0191096   -.0101088
       1989  |  -.0167645   .0023209    -7.22   0.000    -.0213136   -.0122155
       1990  |  -.0200607   .0023488    -8.54   0.000    -.0246643   -.0154571
       1991  |  -.0200974   .0023718    -8.47   0.000    -.0247462   -.0154486
             |
       _cons |  -.2653292   .0162933   -16.28   0.000    -.2972642   -.2333941
------------------------------------------------------------------------------

. est store e6a_pols

. * compute errors from pooled OLS, can calculate residuals directly with option r
. predict error_pols, r

. 
. * cluster
. reg birth globo $controls i.year, cluster(amc_code)

Linear regression                               Number of obs     =     45,188
                                                F(24, 3475)       =     158.01
                                                Prob > F          =     0.0000
                                                R-squared         =     0.1272
                                                Root MSE          =      .0894

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0038792   .0011579    -3.35   0.001    -.0061494    -.001609
         age |   .0294448   .0016364    17.99   0.000     .0262363    .0326532
        age2 |   -.000561   .0000254   -22.05   0.000    -.0006109   -.0005111
       stock |   .0169181   .0020444     8.28   0.000     .0129096    .0209265
      stock2 |  -.0005927   .0001665    -3.56   0.000    -.0009192   -.0002662
 yrsedu_head |  -.0011143   .0005269    -2.11   0.035    -.0021474   -.0000812
 wealth_noTV |  -.0206505    .000981   -21.05   0.000     -.022574   -.0187271
     married |   .0411112   .0042714     9.62   0.000     .0327366    .0494859
    catholic |  -.0009844   .0046691    -0.21   0.833    -.0101388    .0081701
       rural |  -.0087638   .0033231    -2.64   0.008    -.0152792   -.0022484
     doctors |   -.191716   .1747257    -1.10   0.273    -.5342913    .1508594
         ipc |   .1417578   .0559221     2.53   0.011     .0321143    .2514012
             |
        year |
       1980  |   .0046922   .0023642     1.98   0.047     .0000568    .0093275
       1981  |   .0020658   .0022761     0.91   0.364    -.0023968    .0065284
       1982  |   .0008219   .0023309     0.35   0.724    -.0037481    .0053919
       1983  |  -.0011826   .0022709    -0.52   0.603    -.0056351    .0032699
       1984  |  -.0075159   .0023033    -3.26   0.001    -.0120318       -.003
       1985  |  -.0100789   .0023093    -4.36   0.000    -.0146066   -.0055513
       1986  |  -.0116843   .0023007    -5.08   0.000    -.0161951   -.0071734
       1987  |  -.0098917   .0023662    -4.18   0.000     -.014531   -.0052525
       1988  |  -.0146092   .0023753    -6.15   0.000    -.0192663   -.0099521
       1989  |  -.0167645   .0023605    -7.10   0.000    -.0213926   -.0121365
       1990  |  -.0200607   .0024591    -8.16   0.000    -.0248821   -.0152393
       1991  |  -.0200974   .0024186    -8.31   0.000    -.0248395   -.0153554
             |
       _cons |  -.2653292   .0235746   -11.25   0.000    -.3115506   -.2191077
------------------------------------------------------------------------------

. est store e6a_pols_clustered

. 
. * add fixed effects
. areg birth globo $controls i.year, absorb(amc_code)

Linear regression, absorbing indicators         Number of obs     =     45,188
                                                F(  24,  41688)   =     122.03
                                                Prob > F          =     0.0000
                                                R-squared         =     0.2506
                                                Adj R-squared     =     0.1877
                                                Root MSE          =     0.0862

------------------------------------------------------------------------------
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
       globo |  -.0015655   .0015124    -1.04   0.301    -.0045298    .0013988
         age |   .0507963   .0015212    33.39   0.000     .0478147    .0537778
        age2 |  -.0007157   .0000233   -30.75   0.000    -.0007613     -.00067
       stock |  -.0723424   .0027274   -26.52   0.000    -.0776881   -.0669966
      stock2 |   .0032803   .0002003    16.38   0.000     .0028877    .0036729
 yrsedu_head |  -.0019718   .0014663    -1.34   0.179    -.0048458    .0009022
 wealth_noTV |  -.0214739   .0043901    -4.89   0.000    -.0300786   -.0128691
     married |   .1203213   .0084573    14.23   0.000     .1037448    .1368978
    catholic |   .0224631   .0146734     1.53   0.126     -.006297    .0512233
       rural |  -.0041378   .0102848    -0.40   0.687    -.0242962    .0160206
     doctors |  -2.283865   1.661156    -1.37   0.169    -5.539766    .9720363
         ipc |  -.5230551   1.728746    -0.30   0.762    -3.911433    2.865323
             |
        year |
       1980  |    .003441   .0020723     1.66   0.097    -.0006208    .0075028
       1981  |  -.0004398   .0021216    -0.21   0.836    -.0045982    .0037186
       1982  |  -.0031458   .0022009    -1.43   0.153    -.0074596     .001168
       1983  |  -.0063656   .0022514    -2.83   0.005    -.0107784   -.0019528
       1984  |  -.0140051   .0022938    -6.11   0.000     -.018501   -.0095092
       1985  |  -.0176943   .0023425    -7.55   0.000    -.0222857    -.013103
       1986  |  -.0205175   .0024113    -8.51   0.000    -.0252438   -.0157912
       1987  |  -.0202887   .0025115    -8.08   0.000    -.0252112   -.0153662
       1988  |  -.0257683   .0026097    -9.87   0.000    -.0308834   -.0206533
       1989  |  -.0290818   .0027188   -10.70   0.000    -.0344107   -.0237528
       1990  |  -.0332729   .0028416   -11.71   0.000    -.0388426   -.0277032
       1991  |   -.034108   .0029631   -11.51   0.000    -.0399158   -.0283002
             |
       _cons |  -.6420561   .0258469   -24.84   0.000    -.6927165   -.5913956
-------------+----------------------------------------------------------------
    amc_code |    F(3475, 41688) =      1.975   0.000        (3476 categories)

. est store e6a_fe

. predict error_fe, r

. * note this compares to e6a from above
. 
. esttab e6a_pols e6a_pols_clustered e6a_fe e6a, b(%9.4f) se(%9.4f) stat(N r2) drop(*.year) label

------------------------------------------------------------------------------------
                              (1)             (2)             (3)             (4)   
                     (mean) birth    (mean) birth    (mean) birth    (mean) birth   
------------------------------------------------------------------------------------
(mean) globo              -0.0039***      -0.0039***      -0.0016         -0.0016   
                         (0.0010)        (0.0012)        (0.0015)        (0.0017)   

(mean) age                 0.0294***       0.0294***       0.0508***       0.0508***
                         (0.0011)        (0.0016)        (0.0015)        (0.0024)   

(mean) age2               -0.0006***      -0.0006***      -0.0007***      -0.0007***
                         (0.0000)        (0.0000)        (0.0000)        (0.0000)   

(mean) stock               0.0169***       0.0169***      -0.0723***      -0.0723***
                         (0.0013)        (0.0020)        (0.0027)        (0.0050)   

(mean) stock2             -0.0006***      -0.0006***       0.0033***       0.0033***
                         (0.0001)        (0.0002)        (0.0002)        (0.0003)   

(mean) yrsedu_head        -0.0011**       -0.0011*        -0.0020         -0.0020   
                         (0.0004)        (0.0005)        (0.0015)        (0.0029)   

(mean) wealth_noTV        -0.0207***      -0.0207***      -0.0215***      -0.0215*  
                         (0.0008)        (0.0010)        (0.0044)        (0.0088)   

(mean) married             0.0411***       0.0411***       0.1203***       0.1203***
                         (0.0028)        (0.0043)        (0.0085)        (0.0154)   

(mean) catholic           -0.0010         -0.0010          0.0225          0.0225   
                         (0.0038)        (0.0047)        (0.0147)        (0.0186)   

(mean) rural              -0.0088***      -0.0088**       -0.0041         -0.0041   
                         (0.0024)        (0.0033)        (0.0103)        (0.0240)   

(mean) doctors            -0.1917         -0.1917         -2.2839         -2.2839   
                         (0.2964)        (0.1747)        (1.6612)        (1.7433)   

(mean) ipc                 0.1418          0.1418*        -0.5231         -0.5231** 
                         (0.1302)        (0.0559)        (1.7287)        (0.1891)   

Constant                  -0.2653***      -0.2653***      -0.6421***      -0.6421***
                         (0.0163)        (0.0236)        (0.0258)        (0.0392)   
------------------------------------------------------------------------------------
N                        4.52e+04        4.52e+04        4.52e+04        4.52e+04   
r2                         0.1272          0.1272          0.2506          0.2506   
------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.05, ** p<0.01, *** p<0.001

. 
. // let us compare the error terms on the regional level
. sum error_pols error_fe // we impose them to be zero on average

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
  error_pols |     45,188   -1.00e-11    .0893748  -.2333317   .9089372
    error_fe |     45,188    1.87e-11    .0828186  -.4301421   .8387238

. 
. tab uf_code, sum(error_pols)

            |        Summary of Residuals
 State code |        Mean   Std. Dev.       Freq.
------------+------------------------------------
         13 |   .04436596   .05022539          13
         15 |   .02648916   .09855385         637
         17 |  -.00761181    .0913654         221
         21 |   .01314403   .09806006       1,287
         22 |   .00043452    .0982775         897
         23 |  -.00283242   .08136757       1,794
         24 |  -.00632307   .11419615       1,911
         25 |   .00593372   .10556673       2,184
         26 |   .00015561   .07578274       2,106
         27 |   .00433211   .09599164       1,144
         28 |    .0094271   .10413367         962
         29 |    .0086624   .08108138       4,017
         31 |   .00015037    .0951676       9,256
         32 |   .00374068   .06393477         676
         33 |  -.00948814   .04944196         806
         35 |   .00465419   .08390193       7,371
         41 |   -.0132809   .08076205       3,575
         42 |  -.00169681   .08178416       2,327
         43 |  -.00833283   .06178276       1,625
         50 |  -.00587664   .08199885         338
         51 |  -.00245702   .08416754         143
         52 |  -.02202891    .1013549       1,885
         53 |   .01795055   .00793177          13
------------+------------------------------------
      Total |  -1.002e-11   .08937475      45,188

. tab uf_code, sum(error_fe)

            |        Summary of Residuals
 State code |        Mean   Std. Dev.       Freq.
------------+------------------------------------
         13 |  -7.164e-11   .05161429          13
         15 |   9.090e-11   .09141426         637
         17 |   8.771e-11   .08521883         221
         21 |   1.155e-10   .08954727       1,287
         22 |   2.219e-11   .08780002         897
         23 |   3.786e-11   .07582237       1,794
         24 |   1.566e-11   .10626832       1,911
         25 |   3.265e-13   .09798507       2,184
         26 |  -7.030e-11   .07059546       2,106
         27 |   4.729e-11   .09025379       1,144
         28 |   4.221e-11    .0987831         962
         29 |   1.497e-11   .07336242       4,017
         31 |   1.744e-11   .08868762       9,256
         32 |   8.804e-12    .0605177         676
         33 |   4.219e-11   .04516274         806
         35 |   3.421e-11   .07884038       7,371
         41 |  -1.687e-11   .07557292       3,575
         42 |   2.979e-11    .0766561       2,327
         43 |  -7.325e-12   .05796378       1,625
         50 |  -6.163e-11   .07631789         338
         51 |   1.058e-10   .07880467         143
         52 |   2.721e-11    .0950998       1,885
         53 |  -7.444e-11   .00802862          13
------------+------------------------------------
      Total |   1.871e-11   .08281857      45,188

. 
. * want to check for structure in the variances (e.g. heterosked.)
. * are the variances different depending on the geographic region?
. // plot of residuals across uf regions
. scatter error_pols uf_code

. scatter error_fe uf_code

. * within these clusters the errors are not independent, but are correlated
. * so if we use clustered errors, we are getting more accurate s.e.'s
. * this is why we cluster on the district level
. 
. ********************************************************
. * Q.4 Generating a new exposure measure
. use "$datadir/LCD_new", clear

. drop if large!=0
(300,250 observations deleted)

. 
. sort id year

. br id year yr1stcov age globo yrsexp*

. * call another do file, Stata will run the code in the do file (the age calc)
. do "$datadir/corrected_exposure.do"

. gen _yrsexp = year-yr1stcov
(102,535 missing values generated)

. replace _yrsexp = 0 if _yrsexp<0 | _yrsexp==.
(472,329 real changes made)

. 
. egen agecohort = cut(age), at(10,20,30,40,50)

. 
. sort id age

. bysort id agecohort: gen globocoverage = sum(globo)

. 
. // simply break up the year-count-measure by cohorts
. gen _yrsexp1019 = globocoverage if agecohort==10
(1,672,722 missing values generated)

. gen _yrsexp2029 = globocoverage if agecohort==20
(1,356,657 missing values generated)

. gen _yrsexp3039 = globocoverage if agecohort==30
(1,551,044 missing values generated)

. gen _yrsexp4049 = globocoverage if agecohort==40
(1,726,870 missing values generated)

. 
. // remember the unbalanced structure of the panel, so we have to correct for it
. replace _yrsexp1019 = min(_yrsexp,mod(age,10)+1) if _yrsexp>=_yrsexp1019 & _yrsexp1019!=. 
(244,693 real changes made)

. replace _yrsexp2029 = min(_yrsexp,mod(age,10)+1) if _yrsexp>=_yrsexp2029 & _yrsexp2029!=. 
(66,914 real changes made)

. replace _yrsexp3039 = min(_yrsexp,mod(age,10)+1) if _yrsexp>=_yrsexp3039 & _yrsexp3039!=. 
(43,715 real changes made)

. replace _yrsexp4049 = min(_yrsexp,mod(age,10)+1) if _yrsexp>=_yrsexp4049 & _yrsexp4049!=. 
(31,600 real changes made)

. 
. // set up an auxiliary variable
. egen rowtot = rowtotal(_yrsexp1019 -_yrsexp4049)

. gen aux_var = _yrsexp - rowtot

. replace aux_var = 0 if aux_var<0
(0 real changes made)

. drop rowtot

. 
. // filling up the exposure years between 30-39
. replace _yrsexp3039 = min(aux_var,10) if _yrsexp3039==. & _yrsexp4049!=.
(375,561 real changes made)

. 
. // make use of the auxiliary variable
. egen rowtot = rowtotal(_yrsexp1019 -_yrsexp4049)

. replace aux_var = _yrsexp - rowtot
(182,106 real changes made)

. replace aux_var = 0 if aux_var<0
(0 real changes made)

. drop rowtot

. 
. // filling up the exposure years between 20-29
. replace _yrsexp2029 = min(aux_var,10) if _yrsexp2029==. & _yrsexp3039!=.
(926,948 real changes made)

. 
. // make use of the auxiliary variable
. egen rowtot = rowtotal(_yrsexp1019 -_yrsexp4049)

. replace aux_var = _yrsexp - rowtot
(324,002 real changes made)

. replace aux_var = 0 if aux_var<0
(0 real changes made)

. drop rowtot

. 
. // filling up the exposure years between 10-19
. replace _yrsexp1019 = min(aux_var,10) if _yrsexp1019==. & _yrsexp2029!=.
(1,672,722 real changes made)

. replace _yrsexp1019 = mod(age,10)+1 if aux_var>=mod(age,10)+1 & _yrsexp2029==. 
(0 real changes made)

. 
. drop aux_var

. 
. 
. // label our new -- and hopefully correct -- variables
. lab var _yrsexp1019 "Yrs of Globo exp. at 10-19"

. lab var _yrsexp2029 "Yrs of Globo exp. at 20-29"

. lab var _yrsexp3039 "Yrs of Globo exp. at 30-39"

. lab var _yrsexp4049 "Yrs of Globo exp. at 40-49"

. 
end of do-file

. * new variables have underscore
. br id year yr1stcov age globo _yrsexp*

. 
. // HOMEWORK: Comment on the exposure file, briefly describe which steps the 
. // code implements 
. /*  The original data file has incorrect globo exposure levels in each age 
> cohort level - they mostly seem to sum to 10 rather than the true value.
> 
> The corrected do file does the following:
> 1) Calculates the total years of exposure to Globo
> 2) Identify which 10 year age cohort each person is currently in
> 3) Set up a counter "globocoverage" starting at 1 in the year the globo
>    coverage becomes available (1 year lag) 
> 4) Assign the counter to the current cohort group (i.e. 10to19 or 20to29 etc)
> 5) Replace the counter in the cohort group if total exposure years is less than
>    the total number of years being in the age cohort group
> 6) Sum up the rowtotals of exposure (the counters for each cohort, only 1 cohort
>    for each person so far) and calculate the extra years of exposure if total
>    exposure years exceeds the cohort counter (we will use this value to calc.
>    the exposure for all preceeding cohorts in steps 7 through 9, iteratively).
>    This extra exposure is the total expousure that falls into prior age cohorts.
> 7) The 40-49cohort is already correct, so begin with the 30-39 cohort and 
>    using the extra exposure value, fill in the exposure amounts for this cohort.
> 8) Repeat steps 6 and 7 for the 20-29 cohort, recalculating the extra exposure
>    for the earlier age cohorts if any remains.
> 9) Repeat steps 6 and 7 for the 10-19 cohort.
> We now should have correct exposure levels for each cohort via this iterative
> backward process.
> */
. 
. ********************************************************
. * Q.5 Re-estimate columns 4 and 5 of table 4
. 
. // estimation with wrong variable, to match column 4 in paper
. areg birth yrsexp1019 yrsexp2029 yrsexp3039 $controls i.year ///
>  [aweight=weight], absorb(amc_code) cluster(amc_code)
(sum of wgt is 9785696.82302)

Linear regression, absorbing indicators         Number of obs     =  1,118,600
                                                F(  26,   3475)   =     483.51
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0547
                                                Adj R-squared     =     0.0517
                                                Root MSE          =     0.2591

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
  yrsexp1019 |  -.0027089   .0010643    -2.55   0.011    -.0047955   -.0006222
  yrsexp2029 |  -.0044986   .0006602    -6.81   0.000     -.005793   -.0032041
  yrsexp3039 |  -.0065856   .0006208   -10.61   0.000    -.0078029   -.0053684
         age |   .0208124    .001053    19.77   0.000     .0187479    .0228769
        age2 |  -.0003857   .0000154   -25.11   0.000    -.0004158   -.0003556
       stock |   .0002239   .0007149     0.31   0.754    -.0011777    .0016254
      stock2 |    .000112   .0000459     2.44   0.015      .000022    .0002019
 yrsedu_head |    .000251    .000087     2.88   0.004     .0000803    .0004216
 wealth_noTV |  -.0177066   .0005368   -32.99   0.000     -.018759   -.0166541
     married |   .0382801   .0014687    26.06   0.000     .0354005    .0411598
    catholic |  -.0008676   .0007948    -1.09   0.275    -.0024259    .0006906
       rural |   .0007448   .0014345     0.52   0.604    -.0020677    .0035574
     doctors |   .1051716   .1062794     0.99   0.322    -.1032047    .3135479
         ipc |  -.6138853   .0741495    -8.28   0.000    -.7592663   -.4685042
             |
        year |
       1980  |  -.0001644   .0019261    -0.09   0.932    -.0039408     .003612
       1981  |  -.0060091   .0017618    -3.41   0.001    -.0094634   -.0025548
       1982  |  -.0086571      .0017    -5.09   0.000    -.0119901   -.0053241
       1983  |  -.0142978   .0017309    -8.26   0.000    -.0176916    -.010904
       1984  |  -.0192279   .0015878   -12.11   0.000    -.0223411   -.0161147
       1985  |  -.0238372   .0016111   -14.80   0.000     -.026996   -.0206784
       1986  |  -.0238673   .0018043   -13.23   0.000    -.0274048   -.0203298
       1987  |  -.0284257   .0016619   -17.10   0.000    -.0316842   -.0251673
       1988  |  -.0324031     .00182   -17.80   0.000    -.0359715   -.0288347
       1989  |  -.0328594   .0018479   -17.78   0.000    -.0364825   -.0292362
       1990  |  -.0403276   .0018849   -21.39   0.000    -.0440233   -.0366319
       1991  |  -.0407399   .0020285   -20.08   0.000    -.0447169   -.0367628
             |
       _cons |  -.1018534   .0161822    -6.29   0.000     -.133581   -.0701259
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

.  est store e1

. sum age if e(sample)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |  1,118,600    35.81441    7.711916         15         49

. // wrong sample!
. 
. // imposing the right sample, still wrong exposure levels
. areg birth yrsexp1019 yrsexp2029 yrsexp3039 $controls i.year ///
>  [aweight=weight] if age>=30 & age<=49, absorb(amc_code) cluster(amc_code)
(sum of wgt is 8106380.99167)

Linear regression, absorbing indicators         Number of obs     =    926,912
                                                F(  26,   3475)   =     396.19
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0556
                                                Adj R-squared     =     0.0520
                                                Root MSE          =     0.2426

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
  yrsexp1019 |   -.002832   .0009882    -2.87   0.004    -.0047694   -.0008945
  yrsexp2029 |  -.0024186   .0006829    -3.54   0.000    -.0037576   -.0010796
  yrsexp3039 |  -.0002782   .0004501    -0.62   0.537    -.0011607    .0006044
         age |  -.0258938   .0016304   -15.88   0.000    -.0290904   -.0226972
        age2 |   .0002248   .0000202    11.15   0.000     .0001853    .0002643
       stock |   .0002306   .0006841     0.34   0.736    -.0011107    .0015719
      stock2 |   .0001423   .0000432     3.29   0.001     .0000576    .0002271
 yrsedu_head |   .0001891   .0000882     2.14   0.032     .0000161    .0003621
 wealth_noTV |  -.0154215   .0004749   -32.47   0.000    -.0163527   -.0144903
     married |   .0285319   .0008923    31.98   0.000     .0267825    .0302813
    catholic |   .0001152   .0007949     0.14   0.885    -.0014432    .0016737
       rural |   .0026087   .0013516     1.93   0.054    -.0000414    .0052588
     doctors |   .2042412   .1091148     1.87   0.061    -.0096945    .4181768
         ipc |  -.6258864   .0599745   -10.44   0.000    -.7434752   -.5082976
             |
        year |
       1980  |   .0002714   .0020393     0.13   0.894    -.0037268    .0042697
       1981  |  -.0064574    .001684    -3.83   0.000    -.0097591   -.0031556
       1982  |  -.0081926   .0016412    -4.99   0.000    -.0114104   -.0049748
       1983  |  -.0141608   .0017405    -8.14   0.000    -.0175734   -.0107482
       1984  |  -.0186195   .0015676   -11.88   0.000     -.021693    -.015546
       1985  |  -.0224133   .0015944   -14.06   0.000    -.0255393   -.0192872
       1986  |  -.0237915   .0016988   -14.00   0.000    -.0271223   -.0204607
       1987  |  -.0284705   .0015934   -17.87   0.000    -.0315947   -.0253464
       1988  |  -.0320535   .0017173   -18.67   0.000    -.0354205   -.0286865
       1989  |  -.0329781   .0016916   -19.49   0.000    -.0362948   -.0296614
       1990  |  -.0394894   .0016596   -23.79   0.000    -.0427433   -.0362355
       1991  |  -.0410168   .0017735   -23.13   0.000     -.044494   -.0375397
             |
       _cons |   .7456433   .0346095    21.54   0.000     .6777862    .8135003
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

.  est store e2

. sum age if e(sample)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |    926,912    38.24603    5.685939         30         49

. 
. //right variable
. areg birth _yrsexp1019 _yrsexp2029 _yrsexp3039 $controls i.year ///
>  [aweight=weight], absorb(amc_code) cluster(amc_code)
(sum of wgt is 8106380.99167)

Linear regression, absorbing indicators         Number of obs     =    926,912
                                                F(  26,   3475)   =     467.84
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0558
                                                Adj R-squared     =     0.0522
                                                Root MSE          =     0.2426

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 _yrsexp1019 |  -.0023287   .0003893    -5.98   0.000    -.0030919   -.0015655
 _yrsexp2029 |   -.002574   .0003313    -7.77   0.000    -.0032236   -.0019245
 _yrsexp3039 |  -.0006224   .0002377    -2.62   0.009    -.0010885   -.0001563
         age |  -.0217629   .0010879   -20.00   0.000    -.0238959   -.0196298
        age2 |   .0001746   .0000146    11.97   0.000      .000146    .0002032
       stock |   .0001306   .0006823     0.19   0.848    -.0012071    .0014684
      stock2 |   .0001553   .0000442     3.51   0.000     .0000686    .0002419
 yrsedu_head |   .0002101   .0000897     2.34   0.019     .0000342     .000386
 wealth_noTV |  -.0154999   .0004785   -32.39   0.000    -.0164381   -.0145617
     married |   .0284057   .0008962    31.69   0.000     .0266485    .0301629
    catholic |   .0000661   .0007992     0.08   0.934    -.0015009     .001633
       rural |   .0026229   .0013519     1.94   0.052    -.0000276    .0052735
     doctors |    .196101   .1079947     1.82   0.069    -.0156386    .4078405
         ipc |  -.9499048   .1002542    -9.47   0.000    -1.146468   -.7533418
             |
        year |
       1980  |   -.000172   .0024147    -0.07   0.943    -.0049065    .0045624
       1981  |  -.0062574    .001878    -3.33   0.001    -.0099395   -.0025753
       1982  |  -.0071879   .0017067    -4.21   0.000    -.0105341   -.0038416
       1983  |  -.0122576   .0019042    -6.44   0.000    -.0159909   -.0085242
       1984  |  -.0157146   .0017401    -9.03   0.000    -.0191263   -.0123029
       1985  |   -.018417   .0017854   -10.32   0.000    -.0219175   -.0149165
       1986  |  -.0186319   .0020406    -9.13   0.000    -.0226328   -.0146311
       1987  |  -.0220243   .0020013   -11.00   0.000    -.0259482   -.0181005
       1988  |  -.0242472   .0023074   -10.51   0.000    -.0287711   -.0197232
       1989  |  -.0237584   .0024058    -9.88   0.000    -.0284752   -.0190415
       1990  |  -.0293155   .0024417   -12.01   0.000    -.0341029   -.0245281
       1991  |  -.0293184   .0026974   -10.87   0.000    -.0346071   -.0240298
             |
       _cons |   .6664945   .0205558    32.42   0.000     .6261918    .7067971
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

.  est store e3

. sum age if e(sample)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |    926,912    38.24603    5.685939         30         49

. // right variable with constraint
. areg birth _yrsexp1019 _yrsexp2029 _yrsexp3039 $controls i.year ///
>  [aweight=weight] if age>=30 & age<=49, absorb(amc_code) cluster(amc_code)
(sum of wgt is 8106380.99167)

Linear regression, absorbing indicators         Number of obs     =    926,912
                                                F(  26,   3475)   =     467.84
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0558
                                                Adj R-squared     =     0.0522
                                                Root MSE          =     0.2426

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 _yrsexp1019 |  -.0023287   .0003893    -5.98   0.000    -.0030919   -.0015655
 _yrsexp2029 |   -.002574   .0003313    -7.77   0.000    -.0032236   -.0019245
 _yrsexp3039 |  -.0006224   .0002377    -2.62   0.009    -.0010885   -.0001563
         age |  -.0217629   .0010879   -20.00   0.000    -.0238959   -.0196298
        age2 |   .0001746   .0000146    11.97   0.000      .000146    .0002032
       stock |   .0001306   .0006823     0.19   0.848    -.0012071    .0014684
      stock2 |   .0001553   .0000442     3.51   0.000     .0000686    .0002419
 yrsedu_head |   .0002101   .0000897     2.34   0.019     .0000342     .000386
 wealth_noTV |  -.0154999   .0004785   -32.39   0.000    -.0164381   -.0145617
     married |   .0284057   .0008962    31.69   0.000     .0266485    .0301629
    catholic |   .0000661   .0007992     0.08   0.934    -.0015009     .001633
       rural |   .0026229   .0013519     1.94   0.052    -.0000276    .0052735
     doctors |    .196101   .1079947     1.82   0.069    -.0156386    .4078405
         ipc |  -.9499048   .1002542    -9.47   0.000    -1.146468   -.7533418
             |
        year |
       1980  |   -.000172   .0024147    -0.07   0.943    -.0049065    .0045624
       1981  |  -.0062574    .001878    -3.33   0.001    -.0099395   -.0025753
       1982  |  -.0071879   .0017067    -4.21   0.000    -.0105341   -.0038416
       1983  |  -.0122576   .0019042    -6.44   0.000    -.0159909   -.0085242
       1984  |  -.0157146   .0017401    -9.03   0.000    -.0191263   -.0123029
       1985  |   -.018417   .0017854   -10.32   0.000    -.0219175   -.0149165
       1986  |  -.0186319   .0020406    -9.13   0.000    -.0226328   -.0146311
       1987  |  -.0220243   .0020013   -11.00   0.000    -.0259482   -.0181005
       1988  |  -.0242472   .0023074   -10.51   0.000    -.0287711   -.0197232
       1989  |  -.0237584   .0024058    -9.88   0.000    -.0284752   -.0190415
       1990  |  -.0293155   .0024417   -12.01   0.000    -.0341029   -.0245281
       1991  |  -.0293184   .0026974   -10.87   0.000    -.0346071   -.0240298
             |
       _cons |   .6664945   .0205558    32.42   0.000     .6261918    .7067971
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

.  est store e4

. sum age if e(sample)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |    926,912    38.24603    5.685939         30         49

. 
. esttab e1 e2 e3 e4, b(%9.4f) se(%9.4f) stat(N r2) label ///
>  keep(yrsexp* _yrsexp*)

------------------------------------------------------------------------------------
                              (1)             (2)             (3)             (4)   
                     Gave birth~t    Gave birth~t    Gave birth~t    Gave birth~t   
------------------------------------------------------------------------------------
# yrs exposed to g~g      -0.0027*        -0.0028**                                 
                         (0.0011)        (0.0010)                                   

# yrs exposed to g~g      -0.0045***      -0.0024***                                
                         (0.0007)        (0.0007)                                   

# yrs exposed to g~g      -0.0066***      -0.0003                                   
                         (0.0006)        (0.0005)                                   

Yrs of Globo .. a~19                                      -0.0023***      -0.0023***
                                                         (0.0004)        (0.0004)   

Yrs of Globo .. a~29                                      -0.0026***      -0.0026***
                                                         (0.0003)        (0.0003)   

Yrs of Globo .. a~39                                      -0.0006**       -0.0006** 
                                                         (0.0002)        (0.0002)   
------------------------------------------------------------------------------------
N                        1.12e+06        9.27e+05        9.27e+05        9.27e+05   
r2                         0.0547          0.0556          0.0558          0.0558   
------------------------------------------------------------------------------------
Standard errors in parentheses
* p<0.05, ** p<0.01, *** p<0.001

.  
.  // HOMEWORK: instead of instruction on paper, replicate column 5 of table 4
.  // discuss your findings, what do you think about the validity of the paper
.  // in light of these findings? 
.  * do you throw out whole paper, a part of it? what do you do with it?
. 
. // match column 5, but still wrong exposure levels and wrong sample selection
. areg birth yrsexp2029 yrsexp3039 yrsexp4049 $controls i.year ///
>  [aweight=weight], absorb(amc_code) cluster(amc_code)
(sum of wgt is 5244241.25071)

Linear regression, absorbing indicators         Number of obs     =    602,429
                                                F(  26,   3463)   =     175.45
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0639
                                                Adj R-squared     =     0.0585
                                                Root MSE          =     0.2170

                           (Std. Err. adjusted for 3,464 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
  yrsexp2029 |  -.0096532   .0010865    -8.89   0.000    -.0117834   -.0075231
  yrsexp3039 |  -.0101356   .0007892   -12.84   0.000    -.0116829   -.0085883
  yrsexp4049 |  -.0021449   .0006739    -3.18   0.001    -.0034662   -.0008235
         age |   .0227167   .0007775    29.22   0.000     .0211922    .0242412
        age2 |  -.0004087   .0000123   -33.15   0.000    -.0004328   -.0003845
       stock |   .0017033   .0005465     3.12   0.002     .0006319    .0027747
      stock2 |   4.19e-06   .0000371     0.11   0.910    -.0000686     .000077
 yrsedu_head |  -.0001553   .0000853    -1.82   0.069    -.0003226    .0000119
 wealth_noTV |  -.0141842   .0009694   -14.63   0.000    -.0160848   -.0122837
     married |   .0282972     .00328     8.63   0.000     .0218662    .0347282
    catholic |  -.0021375   .0008461    -2.53   0.012    -.0037963   -.0004786
       rural |   .0000519   .0020108     0.03   0.979    -.0038906    .0039944
     doctors |   .0761985   .1466443     0.52   0.603    -.2113195    .3637165
         ipc |  -.4960581   .1030251    -4.81   0.000    -.6980541    -.294062
             |
        year |
       1980  |  -.0014878   .0020956    -0.71   0.478    -.0055966     .002621
       1981  |  -.0045207   .0022475    -2.01   0.044    -.0089273   -.0001141
       1982  |  -.0079918   .0020665    -3.87   0.000    -.0120434   -.0039402
       1983  |  -.0101192   .0019246    -5.26   0.000    -.0138927   -.0063456
       1984  |  -.0132802   .0020163    -6.59   0.000    -.0172335    -.009327
       1985  |  -.0185538    .001888    -9.83   0.000    -.0222555   -.0148521
       1986  |  -.0171687   .0024415    -7.03   0.000    -.0219557   -.0123817
       1987  |  -.0185937   .0020839    -8.92   0.000    -.0226796   -.0145078
       1988  |  -.0232723   .0026921    -8.64   0.000    -.0285504   -.0179941
       1989  |  -.0237257   .0025398    -9.34   0.000    -.0287053   -.0187461
       1990  |  -.0293302   .0027297   -10.74   0.000    -.0346822   -.0239782
       1991  |  -.0291282   .0028699   -10.15   0.000    -.0347551   -.0235013
             |
       _cons |  -.1328134   .0093756   -14.17   0.000    -.1511956   -.1144312
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3464 categories)

.  est store e5match

. sum age if e(sample)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |    602,429    38.19259    9.508283         15         49

.  
. // redo column 5, correcting exposure levels and sample
. areg birth _yrsexp2029 _yrsexp3039 _yrsexp4049 $controls i.year ///
>  [aweight=weight] if age>=40 & age<=49, absorb(amc_code) cluster(amc_code)
(sum of wgt is 3268793.40891)

Linear regression, absorbing indicators         Number of obs     =    375,555
                                                F(  26,   3454)   =      81.38
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0436
                                                Adj R-squared     =     0.0346
                                                Root MSE          =     0.1517

                           (Std. Err. adjusted for 3,455 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
 _yrsexp2029 |   .0006977    .000411     1.70   0.090     -.000108    .0015035
 _yrsexp3039 |   .0004032   .0003726     1.08   0.279    -.0003273    .0011338
 _yrsexp4049 |   .0035521   .0004671     7.60   0.000     .0026363    .0044679
         age |  -.0574973   .0040467   -14.21   0.000    -.0654314   -.0495631
        age2 |   .0005672   .0000438    12.95   0.000     .0004813     .000653
       stock |   .0013757   .0003602     3.82   0.000     .0006695    .0020818
      stock2 |   .0000446   .0000236     1.89   0.059    -1.67e-06    .0000908
 yrsedu_head |  -.0002868   .0000623    -4.60   0.000    -.0004089   -.0001646
 wealth_noTV |  -.0071436   .0004675   -15.28   0.000    -.0080602    -.006227
     married |   .0075678   .0007197    10.52   0.000     .0061567    .0089789
    catholic |  -.0002657   .0006356    -0.42   0.676    -.0015118    .0009805
       rural |   .0032811   .0013949     2.35   0.019     .0005462    .0060161
     doctors |   .4272527   .3573208     1.20   0.232    -.2733288    1.127834
         ipc |  -.5320857   .0775889    -6.86   0.000    -.6842105   -.3799609
             |
        year |
       1980  |  -.0023171   .0020817    -1.11   0.266    -.0063986    .0017645
       1981  |  -.0084611   .0019939    -4.24   0.000    -.0123705   -.0045517
       1982  |  -.0102046   .0017635    -5.79   0.000    -.0136623    -.006747
       1983  |  -.0123527   .0021589    -5.72   0.000    -.0165855   -.0081199
       1984  |   -.015758   .0021011    -7.50   0.000    -.0198776   -.0116384
       1985  |  -.0189826   .0022616    -8.39   0.000    -.0234167   -.0145485
       1986  |  -.0206536   .0024735    -8.35   0.000    -.0255032    -.015804
       1987  |  -.0237416   .0025863    -9.18   0.000    -.0288124   -.0186707
       1988  |  -.0257993   .0028172    -9.16   0.000    -.0313228   -.0202758
       1989  |  -.0291694   .0030237    -9.65   0.000    -.0350977    -.023241
       1990  |  -.0328576   .0034554    -9.51   0.000    -.0396324   -.0260828
       1991  |  -.0346785   .0037624    -9.22   0.000    -.0420553   -.0273017
             |
       _cons |   1.461466   .0931442    15.69   0.000     1.278843    1.644089
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3455 categories)

.  est store e5corr

. sum age if e(sample)

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
         age |    375,555    44.19905    2.866108         40         49

. 
. * compare the paper results with the corrected results
. esttab e5match e5corr, b(%9.4f) se(%9.4f) stat(N r2) label ///
>  keep(yrsexp* _yrsexp*)

----------------------------------------------------
                              (1)             (2)   
                     Gave birth~t    Gave birth~t   
----------------------------------------------------
# yrs exposed to g~g      -0.0097***                
                         (0.0011)                   

# yrs exposed to g~g      -0.0101***                
                         (0.0008)                   

# yrs exposed to g~g      -0.0021**                 
                         (0.0007)                   

Yrs of Globo .. a~29                       0.0007   
                                         (0.0004)   

Yrs of Globo .. a~39                       0.0004   
                                         (0.0004)   

Yrs of Globo .. a~49                       0.0036***
                                         (0.0005)   
----------------------------------------------------
N                        6.02e+05        3.76e+05   
r2                         0.0639          0.0436   
----------------------------------------------------
Standard errors in parentheses
* p<0.05, ** p<0.01, *** p<0.001

.  
.  /*
>  Table 4's results as published in the paper are certainly invalid and should
>  be corrected, with the the conclusions revised.  
>  For column 5, the effects of exposure in the 20 to 29 and 30 to 39 cohort 
>  change from being significant to being insignificant, both economically and 
>  statistically.  Exposure to globo during these years for women in their 40's
>  doesn't have any impact on fertility.  Exposure in their 40's does have some 
>  small and significant impact.
>  In column 4, the effects of exposure in the 30-39 and 40-49 ages are well
>  overestimated, especially for the latter.
>  
>  Table 4 does have some serious mistakes, and should be corrected.  But some
>  of the earlier results with regards to effects of coverage on fertility are 
>  interesting and useful, and the discussion of heterogeneity of effects with 
>  regards to wealth and education are useful.
>  
>  I would argue that the paper should be republished with a corrected table 4
>  and corrected discussion of the heterogeneity of effect.  This makes the 
>  conclusion and impact less broad, but nonetheless still applicable in a 
>  narrower sense and still interesting.
>  */
.  
. ********************************************************
. * Q.6 Replicating Figure 4 by collecting coefficients
. 
. // setting up the exact years for the coverage
. gen t_0 = (year==yr1stcov)

. forvalues k = 1/9 {
  2. gen t_lag_`k' = (year==yr1stcov-`k')
  3. gen t_lead_`k' = (year==yr1stcov+`k')
  4. }

.  
. // running equation (4)
. areg birth t_* $controls i.year [aweight=weight], absorb(amc_code) ///
> cluster(amc_code)
(sum of wgt is 18522526.5012)

Linear regression, absorbing indicators         Number of obs     =  2,102,136
                                                F(  42,   3475)   =     343.34
                                                Prob > F          =     0.0000
                                                R-squared         =     0.0495
                                                Adj R-squared     =     0.0479
                                                Root MSE          =     0.2848

                           (Std. Err. adjusted for 3,476 clusters in amc_code)
------------------------------------------------------------------------------
             |               Robust
       birth |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         t_0 |  -.0007186   .0020163    -0.36   0.722    -.0046719    .0032347
     t_lag_1 |  -.0026421   .0021416    -1.23   0.217    -.0068409    .0015568
    t_lead_1 |  -.0051136   .0019924    -2.57   0.010      -.00902   -.0012071
     t_lag_2 |  -.0020821   .0023641    -0.88   0.379    -.0067172    .0025529
    t_lead_2 |  -.0030765   .0017976    -1.71   0.087    -.0066011     .000448
     t_lag_3 |    .001427   .0025606     0.56   0.577    -.0035934    .0064474
    t_lead_3 |  -.0046694   .0017806    -2.62   0.009    -.0081606   -.0011783
     t_lag_4 |  -.0013193   .0029618    -0.45   0.656    -.0071264    .0044877
    t_lead_4 |  -.0029874   .0017962    -1.66   0.096     -.006509    .0005342
     t_lag_5 |  -.0019413   .0029412    -0.66   0.509    -.0077079    .0038252
    t_lead_5 |  -.0049983    .001563    -3.20   0.001    -.0080628   -.0019338
     t_lag_6 |  -.0013352   .0030251    -0.44   0.659    -.0072664    .0045961
    t_lead_6 |  -.0057335    .001583    -3.62   0.000    -.0088373   -.0026297
     t_lag_7 |   4.53e-06    .003297     0.00   0.999    -.0064598    .0064688
    t_lead_7 |  -.0036802   .0015997    -2.30   0.021    -.0068167   -.0005437
     t_lag_8 |    .001743   .0037992     0.46   0.646    -.0057058    .0091919
    t_lead_8 |  -.0021435   .0013122    -1.63   0.102    -.0047163    .0004292
     t_lag_9 |    .000446   .0035122     0.13   0.899    -.0064402    .0073321
    t_lead_9 |  -.0033143   .0012807    -2.59   0.010    -.0058253   -.0008034
         age |   .0231312   .0005517    41.92   0.000     .0220495     .024213
        age2 |  -.0004212   .0000106   -39.59   0.000    -.0004421   -.0004003
       stock |   .0017486   .0006069     2.88   0.004     .0005588    .0029385
      stock2 |  -.0000225   .0000341    -0.66   0.509    -.0000895    .0000444
 yrsedu_head |  -.0001754   .0001181    -1.48   0.138     -.000407    .0000562
 wealth_noTV |  -.0204699   .0003397   -60.26   0.000    -.0211359   -.0198039
     married |   .0580703     .00119    48.80   0.000     .0557371    .0604034
    catholic |  -.0033083   .0006079    -5.44   0.000    -.0045001   -.0021165
       rural |  -.0047859   .0011488    -4.17   0.000    -.0070382   -.0025336
     doctors |  -.0515458   .0748314    -0.69   0.491    -.1982636    .0951721
         ipc |  -.4535439    .075288    -6.02   0.000    -.6011571   -.3059308
             |
        year |
       1980  |   .0013959   .0014208     0.98   0.326    -.0013897    .0041816
       1981  |  -.0001376   .0013895    -0.10   0.921     -.002862    .0025867
       1982  |  -.0019085   .0012568    -1.52   0.129    -.0043726    .0005556
       1983  |  -.0074975   .0012954    -5.79   0.000    -.0100373   -.0049577
       1984  |  -.0113405    .001263    -8.98   0.000    -.0138167   -.0088643
       1985  |  -.0136572   .0013688    -9.98   0.000    -.0163409   -.0109735
       1986  |  -.0137966   .0013602   -10.14   0.000    -.0164635   -.0111297
       1987  |  -.0158174   .0015089   -10.48   0.000    -.0187758   -.0128589
       1988  |  -.0179805   .0015698   -11.45   0.000    -.0210582   -.0149027
       1989  |  -.0193369   .0015714   -12.31   0.000    -.0224178    -.016256
       1990  |  -.0248936    .001617   -15.39   0.000     -.028064   -.0217232
       1991  |  -.0238446   .0017055   -13.98   0.000    -.0271885   -.0205008
             |
       _cons |  -.1855808   .0065742   -28.23   0.000    -.1984705    -.172691
-------------+----------------------------------------------------------------
    amc_code |   absorbed                                    (3476 categories)

. * need coefficients, signficance bands and years
.  
. // collecting coefficients
. gen coefyear = 0 in 10 // in row 10, we have a 0
(2,102,430 missing values generated)

. gen coef = _b[t_0] in 10
(2,102,430 missing values generated)

. gen lb = _b[t_0] - _se[t_0]*1.645 in 10 // 10% significance interval is 1.645
(2,102,430 missing values generated)

. gen ub = _b[t_0] + _se[t_0]*1.645 in 10
(2,102,430 missing values generated)

. 
. * fill in remaining parts of the loop, _n is the row number
. forvalues k = 1/9 {
  2. replace coefyear = - `k' if _n==10-`k'
  3. replace coefyear = `k' if _n==`k'+10
  4. 
. replace coef = _b[t_lag_`k'] if coefyear==-`k'
  5. replace coef = _b[t_lead_`k'] if coefyear==`k'
  6. 
. replace lb = _b[t_lag_`k'] - _se[t_0]*1.645 if coefyear==-`k'
  7. replace lb = _b[t_lead_`k'] - _se[t_0]*1.645 if coefyear==`k'
  8. 
. replace ub = _b[t_lag_`k'] + _se[t_0]*1.645 if coefyear==-`k'
  9. replace ub = _b[t_lead_`k'] + _se[t_0]*1.645 if coefyear==`k'
 10. 
. }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

. 
. twoway (line coef coefyear) (line lb coefyear) (line ub coefyear)

. 
. // NOTE: don't need to hand in graph as stated on homework, do the other task
.  
. * close the log file 
. log close
      name:  <unnamed>
       log:  C:\Users\roble\Desktop\Working\STATA\HW 8/leonard_exc8.log
  log type:  text
 closed on:  15 Dec 2017, 19:49:41
----------------------------------------------------------------------------------------------------------------------------------------------------------------------
